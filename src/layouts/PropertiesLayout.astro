---
// src/layouts/PropertiesLayout.astro - Layout para p√°gina de propiedades
import Layout from './Layout.astro';
import PropertyCarousel from '../components/PropertyCarousel.astro';

// ===================================================================
// EXTRACCI√ìN DE DATOS DEL PROP
// ===================================================================

const { data } = Astro.props;
const language = data?.language || 'es';

// ===================================================================
// DATOS EST√ÅTICOS DE FALLBACK 
// ===================================================================

let propertiesData = data;

// Si no hay datos, usar fallback est√°tico
if (!propertiesData || !propertiesData.featured) {
  console.log('üè¢ PropertiesLayout: Usando datos est√°ticos de fallback');
  
  propertiesData = {
    language: language,
    featured: [
      {
        slug: 'villa-moderna-punta-cana',
        titulo: language === 'es' ? 'Villa Moderna en Punta Cana' :
                language === 'en' ? 'Modern Villa in Punta Cana' :
                'Villa Moderne √† Punta Cana',
        precio: '$850,000',
        imagen: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800&h=600&fit=crop',
        sector: 'Punta Cana',
        habitaciones: 4,
        banos: 4,
        area: '380 m¬≤',
        tipo: 'Villa',
        destacado: true
      },
      {
        slug: 'apartamento-bavaro',
        titulo: language === 'es' ? 'Apartamento en B√°varo' :
                language === 'en' ? 'Apartment in Bavaro' :
                'Appartement √† Bavaro',
        precio: '$275,000',
        imagen: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
        sector: 'B√°varo',
        habitaciones: 2,
        banos: 2,
        area: '120 m¬≤',
        tipo: 'Apartamento'
      },
      {
        slug: 'casa-las-terrenas',
        titulo: language === 'es' ? 'Casa en Las Terrenas' :
                language === 'en' ? 'House in Las Terrenas' :
                'Maison √† Las Terrenas',
        precio: '$420,000',
        imagen: 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=800&h=600&fit=crop',
        sector: 'Las Terrenas',
        habitaciones: 3,
        banos: 2,
        area: '250 m¬≤',
        tipo: 'Casa'
      }
    ],
    categories: [
      {
        slug: 'apartamentos',
        name: language === 'es' ? 'Apartamentos' : language === 'en' ? 'Apartments' : 'Appartements',
        count: 145,
        image: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=400&h=300&fit=crop',
        priceRange: '$180K - $850K'
      },
      {
        slug: 'casas',
        name: language === 'es' ? 'Casas' : language === 'en' ? 'Houses' : 'Maisons',
        count: 89,
        image: 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=400&h=300&fit=crop',
        priceRange: '$320K - $1.2M'
      },
      {
        slug: 'villas',
        name: 'Villas',
        count: 67,
        image: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=400&h=300&fit=crop',
        priceRange: '$650K - $2.5M'
      },
      {
        slug: 'proyectos',
        name: language === 'es' ? 'Proyectos' : language === 'en' ? 'Projects' : 'Projets',
        count: 23,
        image: 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=400&h=300&fit=crop',
        priceRange: language === 'es' ? 'Desde $150K' : language === 'en' ? 'From $150K' : '√Ä partir de $150K'
      }
    ],
    locations: [
      {
        slug: 'punta-cana',
        name: 'Punta Cana',
        count: 124,
        image: 'https://images.unsplash.com/photo-1540206063137-4a88ca974d1a?w=400&h=300&fit=crop',
        description: language === 'es' ? 'Playas paradis√≠acas y resorts de lujo' :
                     language === 'en' ? 'Paradise beaches and luxury resorts' :
                     'Plages paradisiaques et complexes de luxe'
      },
      {
        slug: 'santo-domingo',
        name: 'Santo Domingo',
        count: 98,
        image: 'https://images.unsplash.com/photo-1582737133474-778d4909a5b0?w=400&h=300&fit=crop',
        description: language === 'es' ? 'Capital hist√≥rica y centro econ√≥mico' :
                     language === 'en' ? 'Historic capital and economic center' :
                     'Capitale historique et centre √©conomique'
      },
      {
        slug: 'las-terrenas',
        name: 'Las Terrenas',
        count: 56,
        image: 'https://images.unsplash.com/photo-1566822207-8ad0bb87ca50?w=400&h=300&fit=crop',
        description: language === 'es' ? 'Encanto europeo en el Caribe' :
                     language === 'en' ? 'European charm in the Caribbean' :
                     'Charme europ√©en dans les Cara√Øbes'
      },
      {
        slug: 'la-romana',
        name: 'La Romana',
        count: 43,
        image: 'https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=400&h=300&fit=crop',
        description: language === 'es' ? 'Golf de clase mundial y marinas' :
                     language === 'en' ? 'World-class golf and marinas' :
                     'Golf de classe mondiale et marinas'
      }
    ],
    stats: [
      { 
        number: '450+', 
        label: language === 'es' ? 'Propiedades disponibles' :
               language === 'en' ? 'Properties available' :
               'Propri√©t√©s disponibles'
      },
      { 
        number: '15', 
        label: language === 'es' ? 'Ubicaciones' :
               language === 'en' ? 'Locations' :
               'Emplacements'
      },
      { 
        number: '95%', 
        label: language === 'es' ? 'Clientes satisfechos' :
               language === 'en' ? 'Satisfied clients' :
               'Clients satisfaits'
      },
      { 
        number: '$180K+', 
        label: language === 'es' ? 'Precio promedio' :
               language === 'en' ? 'Average price' :
               'Prix moyen'
      }
    ],
    services: [
      {
        icon: 'üè†',
        title: language === 'es' ? 'Compra de Propiedades' :
               language === 'en' ? 'Property Purchase' :
               'Achat de Propri√©t√©s',
        description: language === 'es' ? 'Te ayudamos a encontrar y adquirir la propiedad perfecta' :
                     language === 'en' ? 'We help you find and acquire the perfect property' :
                     'Nous vous aidons √† trouver et acqu√©rir la propri√©t√© parfaite'
      },
      {
        icon: 'üí∞',
        title: language === 'es' ? 'Venta de Propiedades' :
               language === 'en' ? 'Property Sales' :
               'Vente de Propri√©t√©s',
        description: language === 'es' ? 'Comercializamos tu propiedad con estrategias efectivas' :
                     language === 'en' ? 'We market your property with effective strategies' :
                     'Nous commercialisons votre propri√©t√© avec des strat√©gies efficaces'
      },
      {
        icon: 'üìà',
        title: language === 'es' ? 'Inversi√≥n Inmobiliaria' :
               language === 'en' ? 'Real Estate Investment' :
               'Investissement Immobilier',
        description: language === 'es' ? 'Asesor√≠a especializada para inversores' :
                     language === 'en' ? 'Specialized advice for investors' :
                     'Conseils sp√©cialis√©s pour les investisseurs'
      },
      {
        icon: 'üèñÔ∏è',
        title: language === 'es' ? 'Rentas Vacacionales' :
               language === 'en' ? 'Vacation Rentals' :
               'Locations de Vacances',
        description: language === 'es' ? 'Maximiza ingresos con nuestra plataforma' :
                     language === 'en' ? 'Maximize income with our platform' :
                     'Maximisez les revenus avec notre plateforme'
      }
    ],
    seo: {
      title: language === 'es' ? 'Propiedades en Venta - Rep√∫blica Dominicana | CLIC' :
             language === 'en' ? 'Properties for Sale - Dominican Republic | CLIC' :
             'Propri√©t√©s √† Vendre - R√©publique Dominicaine | CLIC',
      description: language === 'es' ? 'Encuentra tu propiedad ideal en Rep√∫blica Dominicana. Apartamentos, casas, villas y proyectos en las mejores ubicaciones.' :
                   language === 'en' ? 'Find your ideal property in Dominican Republic. Apartments, houses, villas and projects in the best locations.' :
                   'Trouvez votre propri√©t√© id√©ale en R√©publique Dominicaine. Appartements, maisons, villas et projets dans les meilleurs emplacements.'
    }
  };
}

// ===================================================================
// PROCESAR DATOS FINALES
// ===================================================================

const featured = propertiesData.featured || [];
const categories = propertiesData.categories || [];
const locations = propertiesData.locations || [];
const stats = propertiesData.stats || [];
const services = propertiesData.services || [];

// ===================================================================
// TEXTOS POR IDIOMA
// ===================================================================

const TEXTS = {
  es: {
    heroTitle: 'Encuentra tu Hogar Ideal',
    heroSubtitle: 'Descubre las mejores propiedades en Rep√∫blica Dominicana. Desde apartamentos en la playa hasta villas de lujo.',
    browseProperties: 'Ver todas las propiedades',
    searchProperties: 'Buscar propiedades',
    featuredTitle: 'Propiedades Destacadas',
    featuredSubtitle: 'Las mejores opciones seleccionadas para ti',
    categoriesTitle: 'Explora por Tipo',
    categoriesSubtitle: 'Encuentra exactamente lo que buscas',
    locationsTitle: 'Ubicaciones Populares',
    locationsSubtitle: 'Descubre los mejores destinos',
    servicesTitle: 'Nuestros Servicios',
    servicesSubtitle: 'Te acompa√±amos en todo el proceso',
    properties: 'propiedades',
    viewAll: 'Ver todas',
    learnMore: 'Conocer m√°s',
    fromPrice: 'Desde',
    searchPlaceholder: 'Buscar por ubicaci√≥n, tipo o precio...',
    searchButton: 'Buscar'
  },
  en: {
    heroTitle: 'Find Your Ideal Home',
    heroSubtitle: 'Discover the best properties in Dominican Republic. From beachfront apartments to luxury villas.',
    browseProperties: 'View all properties',
    searchProperties: 'Search properties',
    featuredTitle: 'Featured Properties',
    featuredSubtitle: 'The best options selected for you',
    categoriesTitle: 'Browse by Type',
    categoriesSubtitle: 'Find exactly what you\'re looking for',
    locationsTitle: 'Popular Locations',
    locationsSubtitle: 'Discover the best destinations',
    servicesTitle: 'Our Services',
    servicesSubtitle: 'We accompany you throughout the process',
    properties: 'properties',
    viewAll: 'View all',
    learnMore: 'Learn more',
    fromPrice: 'From',
    searchPlaceholder: 'Search by location, type or price...',
    searchButton: 'Search'
  },
  fr: {
    heroTitle: 'Trouvez votre Maison Id√©ale',
    heroSubtitle: 'D√©couvrez les meilleures propri√©t√©s en R√©publique Dominicaine. Des appartements en bord de mer aux villas de luxe.',
    browseProperties: 'Voir toutes les propri√©t√©s',
    searchProperties: 'Rechercher des propri√©t√©s',
    featuredTitle: 'Propri√©t√©s en Vedette',
    featuredSubtitle: 'Les meilleures options s√©lectionn√©es pour vous',
    categoriesTitle: 'Parcourir par Type',
    categoriesSubtitle: 'Trouvez exactement ce que vous cherchez',
    locationsTitle: 'Emplacements Populaires',
    locationsSubtitle: 'D√©couvrez les meilleures destinations',
    servicesTitle: 'Nos Services',
    servicesSubtitle: 'Nous vous accompagnons tout au long du processus',
    properties: 'propri√©t√©s',
    viewAll: 'Voir tout',
    learnMore: 'En savoir plus',
    fromPrice: '√Ä partir de',
    searchPlaceholder: 'Rechercher par emplacement, type ou prix...',
    searchButton: 'Rechercher'
  }
};

const text = TEXTS[language] || TEXTS.es;

// URLs seg√∫n idioma
const routes = {
  es: {
    allProperties: '/propiedades',
    contact: '/contacto',
    sell: '/vender',
    vacationRentals: '/rentas-vacacionales'
  },
  en: {
    allProperties: '/en/properties',
    contact: '/en/contact', 
    sell: '/en/sell',
    vacationRentals: '/en/vacation-rentals'
  },
  fr: {
    allProperties: '/fr/proprietes',
    contact: '/fr/contact',
    sell: '/fr/vendre', 
    vacationRentals: '/fr/locations-vacances'
  }
};

const currentRoutes = routes[language] || routes.es;

console.log('‚úÖ PropertiesLayout preparado:', {
  language,
  featuredCount: featured.length,
  categoriesCount: categories.length,
  locationsCount: locations.length,
  servicesCount: services.length
});
---

<Layout 
  title={propertiesData.seo?.title || text.heroTitle}
  description={propertiesData.seo?.description || text.heroSubtitle}
  language={language}
>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-r from-blue-600 to-purple-700 py-20 overflow-hidden min-h-[600px]">
    <!-- Background Image -->
    <div class="absolute inset-0">
      <img 
        src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80" 
        alt="Propiedades en Rep√∫blica Dominicana"
        class="w-full h-full object-cover opacity-30"
      />
      <div class="absolute inset-0 bg-gradient-to-r from-blue-600/85 to-purple-700/80"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10">
      <div class="max-w-4xl mx-auto text-center text-white">
        <h1 class="text-4xl md:text-6xl font-bold mb-6 drop-shadow-lg">
          {text.heroTitle}
        </h1>
        <p class="text-xl md:text-2xl mb-8 text-white drop-shadow-md">
          {text.heroSubtitle}
        </p>
        
        <!-- Search Bar -->
        <div class="max-w-2xl mx-auto mb-8">
          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
            <div class="flex flex-col sm:flex-row gap-4">
              <input 
                type="text" 
                placeholder={text.searchPlaceholder}
                class="flex-1 px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white/50 focus:outline-none"
              />
              <button class="px-6 py-3 bg-white text-blue-600 rounded-lg hover:bg-gray-100 transition-colors font-semibold">
                {text.searchButton}
              </button>
            </div>
          </div>
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
          {stats.map((stat) => (
            <div class="text-center bg-white/15 backdrop-blur-sm rounded-lg p-4">
              <div class="text-3xl font-bold text-white mb-2">{stat.number}</div>
              <div class="text-sm text-white/80">{stat.label}</div>
            </div>
          ))}
        </div>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href={currentRoutes.allProperties}
            class="inline-block px-8 py-4 bg-white text-blue-600 rounded-lg hover:bg-gray-100 transition-colors font-semibold shadow-lg"
          >
            {text.browseProperties}
          </a>
          <a 
            href="#destacadas"
            class="inline-block px-8 py-4 bg-white/20 backdrop-blur-sm text-white border border-white/30 rounded-lg hover:bg-white/30 transition-colors font-semibold"
          >
            {text.featuredTitle}
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Properties -->
  {featured.length > 0 && (
    <section id="destacadas" class="py-16 bg-gray-50">
      <PropertyCarousel 
        title={text.featuredTitle}
        subtitle={text.featuredSubtitle}
        properties={featured}
        viewAllLink={currentRoutes.allProperties}
      />
    </section>
  )}

  <!-- Categories -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          {text.categoriesTitle}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          {text.categoriesSubtitle}
        </p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        {categories.map((category) => (
          <a 
            href={`${currentRoutes.allProperties}/${category.slug}`}
            class="group bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow"
          >
            <div class="relative h-48">
              <img 
                src={category.image} 
                alt={category.name}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
              <div class="absolute bottom-4 left-4 text-white">
                <h3 class="text-xl font-bold mb-1">{category.name}</h3>
                <p class="text-sm text-white/80">{category.count} {text.properties}</p>
              </div>
            </div>
            <div class="p-4">
              <p class="text-gray-600 text-sm mb-2">{category.priceRange}</p>
              <div class="flex items-center text-blue-600 text-sm font-medium">
                {text.viewAll}
                <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Locations -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          {text.locationsTitle}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          {text.locationsSubtitle}
        </p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        {locations.map((location) => (
          <a 
            href={`${currentRoutes.allProperties}?ubicacion=${location.slug}`}
            class="group bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow"
          >
            <div class="relative h-56">
              <img 
                src={location.image} 
                alt={location.name}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
              <div class="absolute bottom-4 left-4 right-4 text-white">
                <h3 class="text-xl font-bold mb-1">{location.name}</h3>
                <p class="text-sm text-white/90 mb-2">{location.description}</p>
                <p class="text-xs text-white/70">{location.count} {text.properties}</p>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Services -->
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
          {text.servicesTitle}
        </h2>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          {text.servicesSubtitle}
        </p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        {services.map((service) => (
          <div class="text-center p-6 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
            <div class="text-4xl mb-4">{service.icon}</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-3">{service.title}</h3>
            <p class="text-gray-600 text-sm mb-4">{service.description}</p>
            <a 
              href={service.title.includes('Venta') || service.title.includes('Sales') || service.title.includes('Vente') ? currentRoutes.sell : 
                    service.title.includes('Rentas') || service.title.includes('Vacation') || service.title.includes('Locations') ? currentRoutes.vacationRentals :
                    currentRoutes.contact}
              class="text-blue-600 text-sm font-medium hover:text-blue-700 transition-colors"
            >
              {text.learnMore}
            </a>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16 bg-gradient-to-r from-blue-600 to-purple-700">
    <div class="container mx-auto px-4 text-center">
      <div class="max-w-3xl mx-auto text-white">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">
          {language === 'es' ? '¬øListo para encontrar tu hogar ideal?' :
           language === 'en' ? 'Ready to find your ideal home?' :
           'Pr√™t √† trouver votre maison id√©ale?'}
        </h2>
        <p class="text-xl mb-8 text-white/90">
          {language === 'es' ? 'Tenemos las mejores propiedades esper√°ndote. Comienza tu b√∫squeda hoy mismo.' :
           language === 'en' ? 'We have the best properties waiting for you. Start your search today.' :
           'Nous avons les meilleures propri√©t√©s qui vous attendent. Commencez votre recherche aujourd\'hui.'}
        </p>
        
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a 
            href={currentRoutes.allProperties}
            class="inline-block px-8 py-3 bg-white text-blue-600 rounded-lg hover:bg-gray-100 transition-colors font-semibold"
          >
            {text.searchProperties}
          </a>
          <a 
            href={currentRoutes.contact}
            class="inline-block px-8 py-3 bg-white/20 text-white border border-white/30 rounded-lg hover:bg-white/30 transition-colors font-semibold"
          >
            {language === 'es' ? 'Hablar con asesor' :
             language === 'en' ? 'Talk to advisor' :
             'Parler √† un conseiller'}
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>