---
// src/layouts/HomepageLayout.astro - REORDENADO PARA UX/SEO + TEAM SECTION MEJORADA
import Layout from './Layout.astro';
import SearchComponent from '../components/SearchComponent.astro';
import PropertyCarousel from '../components/PropertyCarousel.astro';
import VideoGallery from '../components/VideoGallery.astro';
import RelatedArticles from '../components/RelatedArticles.astro';
import Testimonials from '../components/Testimonials.astro';
import PopularLocations from '../components/PopularLocations.astro';
import DynamicFAQs from '../components/DynamicFAQs.astro';

export interface Props {
  data: any;
  language?: string;
}

const { data, language = 'es' } = Astro.props;

// Extraer datos del homepage handler - CORREGIDO seg√∫n logs reales
const pageData = data;
const countryConfig = pageData.countryConfig || {};
const globalConfig = pageData.globalConfig || {};
const country = pageData.country || {}; 
const hotItems = pageData.hotItems || { cities: [], sectors: [], properties: [], agents: [], projects: [], custom: [] };
const countryCode = globalConfig?.country || countryConfig?.code || 'DOM'; 
const countryName = country?.name || countryConfig?.name || 'Rep√∫blica Dominicana';

// USAR LOS DATOS REALES que llegan seg√∫n los logs
const isDefaultCountry = countryConfig?.isDefault === true || 
                        countryConfig?.showReneBranding === true ||
                        globalConfig?.country === 'DOM';

// Extraer secciones del homepage handler
const homepageSections = pageData.sections || [];
const heroSection = homepageSections.find(s => s.type === 'hero');
const featuredPropsSection = homepageSections.find(s => s.type === 'property-carousel');
const testimonialsSection = homepageSections.find(s => s.type === 'testimonials');
const advisorsSection = homepageSections.find(s => s.type === 'advisors');
const contentMixSection = homepageSections.find(s => s.type === 'content-mix');
const founderStorySection = homepageSections.find(s => s.type === 'founder-story');
const faqsSection = homepageSections.find(s => s.type === 'faq');

// Datos procesados del handler
const featuredProperties = featuredPropsSection?.properties || [];
const testimonials = testimonialsSection?.testimonials || [];
const featuredAdvisors = advisorsSection?.advisors || [];
const featuredVideos = contentMixSection?.videos || founderStorySection?.recentContent?.videos || [];
const featuredArticles = contentMixSection?.articles || founderStorySection?.recentContent?.articles || [];
const searchFilters = pageData.searchFilters || {};
const quickStats = pageData.quickStats || {};
const faqs = faqsSection?.faqs || [];

// Funci√≥n para limpiar HTML del contenido de bio
function stripHtmlTags(html: string): string {
  if (!html) return '';
  return html
    .replace(/<[^>]*>/g, '') // Remover tags HTML
    .replace(/&nbsp;/g, ' ') // Reemplazar &nbsp; con espacios
    .replace(/&amp;/g, '&') // Reemplazar &amp; con &
    .replace(/&lt;/g, '<') // Reemplazar &lt; con <
    .replace(/&gt;/g, '>') // Reemplazar &gt; con >
    .replace(/\s+/g, ' ') // Reemplazar m√∫ltiples espacios con uno solo
    .trim(); // Remover espacios al inicio y final
}

// Funci√≥n para arreglar avatares por defecto
function getAvatarUrl(avatar: string | undefined): string {
  const defaultAvatar = 'https://pacewqgypevfgjmdsorz.supabase.co/storage/v1/object/public/public-assets/images/default-avatarww.jpg';
  
  if (!avatar || avatar.includes('/images/team/default-advisor.jpg') || avatar.includes('default-avatar')) {
    return defaultAvatar;
  }
  
  return avatar;
}

// Hero configuration del handler
const heroConfig = heroSection || {};
const companyName = globalConfig?.legal?.company_name || `CLIC Real Estate ${countryCode}`;
const founderName = isDefaultCountry ? 'Ren√© Castillo' : globalConfig?.social?.founder?.name || 'Local Expert';
const founderExperience = isDefaultCountry ? '18 a√±os' : globalConfig?.team?.founder_experience || '8+ a√±os';

// SEO y layout props
const seoData = pageData.seo || {};
const layoutProps = {
  title: seoData.title || `${companyName} - Premium Real Estate in ${countryName}`,
  description: seoData.description || `Find luxury properties in ${countryName} with ${companyName}. Expert guidance and personalized service.`,
  ogImage: seoData.open_graph?.image || heroConfig.backgroundImage || '/og-default.jpg',
  canonical: seoData.canonical_url,
  keywords: seoData.keywords,
  hreflangData: seoData.hreflang || {},
  globalConfig: globalConfig,
  language: language,
  trackingString: pageData.trackingString || '',
  hotItems: pageData.hotItems || {},
  country: pageData.country || {}
};

// Condici√≥n para mostrar PopularLocations
const shouldShowPopularLocations = (hotItems.cities && hotItems.cities.length > 0) || (hotItems.sectors && hotItems.sectors.length > 0);

// Build enhanced context for components
const enhancedContext = {
  location: countryName,
  country: countryName,
  isDefault: isDefaultCountry,
  
  seoData: {
    country: { name: countryName, code: countryCode }
  },
  
  insights: {
    hasMarketInsights: true,
    hasTips: true,
    hasInvestmentData: true,
    hasNeighborhoodInfo: true
  }
};

// Debug logging
if (import.meta.env.DEV) {
  console.log('üè† Homepage Layout Debug:', {
    'isDefaultCountry': isDefaultCountry,
    'Should show PopularLocations': shouldShowPopularLocations,
    'Cities available': hotItems?.cities?.length || 0,
    'Sectors available': hotItems?.sectors?.length || 0,
    'FAQs available': faqs.length,
    'Advisors available': featuredAdvisors.length,
    'Videos available': featuredVideos.length,
    'Articles available': featuredArticles.length
  });
}
---

<Layout {...layoutProps}>

  <!-- Hero Section - Con badge flotante arriba -->
  <section class="relative min-h-[75vh] py-16 flex items-center justify-center">
    <!-- Background espec√≠fico del pa√≠s del handler -->
    <div class="absolute inset-0 z-0">
      <div class="absolute inset-0 bg-gradient-to-r from-black/70 via-black/50 to-black/70 z-10"></div>
      <img 
        src={heroConfig.backgroundImage || "https://images.unsplash.com/photo-1600047509807-ba8f99d2cdde?w=1920&h=1080&fit=crop&auto=format&q=80"}
        alt={`${language === 'es' ? 'Propiedades de lujo en' : language === 'en' ? 'Luxury properties in' : 'Propri√©t√©s de luxe en'} ${countryName}`}
        class="w-full h-full object-cover"
        style={heroConfig.overlayOpacity ? `filter: brightness(${1 - heroConfig.overlayOpacity + 0.3})` : ''}
      />
    </div>

    <!-- Badge Flotante Elegante -->
    <div class="absolute top-3 left-1/2 transform -translate-x-1/2 z-30">
      <div class="inline-flex items-center gap-2">
        <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 24 24">
          <path d="M22.25 12c0-1.43-.88-2.67-2.19-3.34.46-1.39.2-2.9-.81-3.91s-2.52-1.27-3.91-.81c-.66-1.31-1.91-2.19-3.34-2.19s-2.67.88-3.34 2.19c-1.39-.46-2.9-.2-3.91.81s-1.27 2.52-.81 3.91c-1.31.66-2.19 1.91-2.19 3.34s.88 2.67 2.19 3.34c-.46 1.39-.2 2.9.81 3.91s2.52 1.27 3.91.81c.66 1.31 1.91 2.19 3.34 2.19s2.67-.88 3.34-2.19c1.39.46 2.9.2 3.91-.81s1.27-2.52.81-3.91c1.31-.66 2.19-1.91 2.19-3.34zm-11.71 4.2L6.8 12.46l1.41-1.42 2.26 2.26 4.8-5.23 1.47 1.36-6.2 6.77z"/>
        </svg>
        <span class="text-gray-200 text-sm font-medium drop-shadow-lg">
          {isDefaultCountry && language === 'es' && `Fundada por ${founderName} ‚Ä¢ Presentador TV ${founderExperience}`}
          {isDefaultCountry && language === 'en' && `Founded by ${founderName} ‚Ä¢ TV Host ${founderExperience}`}
          {isDefaultCountry && language === 'fr' && `Fond√©e par ${founderName} ‚Ä¢ Pr√©sentateur TV ${founderExperience}`}
          {!isDefaultCountry && language === 'es' && `${companyName} ‚Ä¢ Expertos Locales ${founderExperience}`}
          {!isDefaultCountry && language === 'en' && `${companyName} ‚Ä¢ Local Experts ${founderExperience}`}
          {!isDefaultCountry && language === 'fr' && `${companyName} ‚Ä¢ Experts Locaux ${founderExperience}`}
        </span>
      </div>
    </div>
    
    <!-- SEO INVISIBLE - Solo para Google -->
    <div class="sr-only">
      <h1>{seoData.h1 || seoData.title}</h1>
      <p>{seoData.description}</p>
      <address>
        <span>{founderName}, {isDefaultCountry ? 'Fundador y Presentador de TV' : 'Local Expert'}</span>
        <span>{companyName}</span>
        <span>{globalConfig?.contact?.address || `${countryName} Office`}</span>
        <span>Tel√©fono: {globalConfig?.contact?.phone || 'Contact Available'}</span>
        <span>Email: {globalConfig?.contact?.email || 'info@clic.com'}</span>
      </address>
    </div>
    
    <!-- Content VISUAL -->
    <div class="relative z-20 container mx-auto px-4">
      <div class="max-w-5xl mx-auto">
        <div class="text-center">
          <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-5 text-white leading-tight">
            {heroConfig.title || companyName}
          </h2>
          <h3 class="text-xl md:text-2xl lg:text-3xl font-bold mb-6 text-[#f04e00] leading-tight">
            {heroConfig.tagline}
          </h3>
          <p class="text-lg md:text-xl mb-10 text-white/90 leading-relaxed max-w-5xl mx-auto">
            {heroConfig.subtitle}
          </p>
        </div>

        <!-- BUSCADOR CENTRADO -->
        <div class="mb-8">
          <SearchComponent 
            showTitle={false}
            searchFilters={searchFilters}
            language={language}
            countryContext={{
              code: countryCode,
              name: countryName,
              hasContent: countryConfig.hasContent
            }}
          />
        </div>

        <!-- Value Propositions -->
        <div class="text-center">
          <div class="flex flex-wrap items-center justify-center gap-8 text-sm text-white/80">
            <span class="flex items-center gap-2">
              <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
              <span class="font-medium">
                {language === 'es' ? "Asesor√≠a personalizada" : language === 'en' ? "Personalized advice" : "Conseil personnalis√©"}
              </span>
            </span>
            <span class="flex items-center gap-2">
              <div class="w-2 h-2 bg-amber-400 rounded-full"></div>
              <span class="font-medium">
                {language === 'es' ? "Experiencia local" : language === 'en' ? "Local expertise" : "Expertise locale"}
              </span>
            </span>
            <span class="flex items-center gap-2">
              <div class="w-2 h-2 bg-emerald-400 rounded-full"></div>
              <span class="font-medium">
                {language === 'es' ? "Proceso transparente" : language === 'en' ? "Transparent process" : "Processus transparent"}
              </span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Estad√≠sticas R√°pidas del Pa√≠s -->
  {countryConfig.hasContent && quickStats && (
    <section class="py-8 bg-gray-900 text-white">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
          <div>
            <div class="text-2xl md:text-3xl font-bold text-[#f04e00]">
              {quickStats.totalProperties || 0}+
            </div>
            <div class="text-sm opacity-75">
              {language === 'es' ? 'Propiedades' : language === 'en' ? 'Properties' : 'Propri√©t√©s'}
            </div>
          </div>
          <div>
            <div class="text-2xl md:text-3xl font-bold text-[#f04e00]">
              {quickStats.totalAdvisors || 0}+
            </div>
            <div class="text-sm opacity-75">
              {language === 'es' ? 'Asesores' : language === 'en' ? 'Advisors' : 'Conseillers'}
            </div>
          </div>
          <div>
            <div class="text-2xl md:text-3xl font-bold text-[#f04e00]">
              {quickStats.averageRating || '4.9'}‚òÖ
            </div>
            <div class="text-sm opacity-75">
              {language === 'es' ? 'Satisfacci√≥n' : language === 'en' ? 'Satisfaction' : 'Satisfaction'}
            </div>
          </div>
          <div>
            <div class="text-2xl md:text-3xl font-bold text-[#f04e00]">
              {Math.round((pageData.marketInsights?.totalListings || quickStats.totalProperties || 0) * 1.2)}+
            </div>
            <div class="text-sm opacity-75">
              {language === 'es' ? 'Listados' : language === 'en' ? 'Listings' : 'Annonces'}
            </div>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- 1. Popular Locations - PRIMERO -->
  {shouldShowPopularLocations && (
    <PopularLocations 
      hotItems={hotItems}
      showType="mixed"
      dataSource="edge_function"
      showBadges={true}
      language={language}
      context={{
        country: countryName,
        code: countryCode,
        isDefault: isDefaultCountry
      }}
      layout="grid"
      maxItems={12}
      loadingStrategy="eager"
      title={language === 'es' ? 'Descubre las Mejores Oportunidades de Inversi√≥n' :
             language === 'en' ? 'Discover the Best Investment Opportunities' :
             'D√©couvrez les Meilleures Opportunit√©s d\'Investissement'}
      subtitle={language === 'es' ? `Explora ciudades y sectores con alto potencial en ${countryName}` :
                language === 'en' ? `Explore cities and sectors with high potential in ${countryName}` :
                `Explorez les villes et secteurs √† fort potentiel en ${countryName}`}
    />
  )}

  <!-- 2. Featured Properties - SEGUNDO (Conversi√≥n principal) -->
  {featuredProperties && featuredProperties.length > 0 && (
    <PropertyCarousel 
      title={featuredPropsSection?.title}
      subtitle={language === 'es' ? `Las mejores propiedades disponibles en ${countryName}` : 
                language === 'en' ? `The best properties available in ${countryName}` : 
                `Les meilleures propri√©t√©s disponibles en ${countryName}`}
      properties={featuredProperties}
      viewAllLink={featuredPropsSection?.viewAllUrl}
      theme="luxury"
      language={language}
      countryContext={{
        code: countryCode,
        name: countryName
      }}
    />
  )}

  <!-- 3. Founder Story - TERCERO (Credibilidad temprana - solo RD) -->
  {isDefaultCountry && (
    <section class="py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <div>
            <span class="text-[#f04e00] font-semibold text-sm uppercase tracking-wider">
              {language === 'es' ? "La Historia de CLIC" : 
               language === 'en' ? "The CLIC Story" : 
               "L'Histoire de CLIC"}
            </span>
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-6 mt-2">
              {language === 'es' ? "De la Televisi√≥n a los Bienes Ra√≠ces" : 
               language === 'en' ? "From Television to Real Estate" : 
               "De la T√©l√©vision √† l'Immobilier"}
            </h2>
            <div class="space-y-4 text-lg text-gray-600">
              {language === 'es' && (
                <>
                  <p>
                    <strong class="text-gray-900">Ren√© Castillo se ha posicionado como el presentador inmobiliario m√°s reconocido de Rep√∫blica Dominicana</strong>, 
                    llevando a los televidentes dentro de las casas m√°s exclusivas de celebridades y figuras p√∫blicas del pa√≠s.
                  </p>
                  <p>
                    Con <strong class="text-gray-900">18 a√±os de experiencia televisiva, 600K+ seguidores en redes sociales 
                    y un canal de YouTube con 200K+ suscriptores y millones de visualizaciones</strong>, Ren√© combina 
                    entretenimiento y bienes ra√≠ces de manera √∫nica en el mercado dominicano.
                  </p>
                  <p>
                    A trav√©s de <strong class="text-gray-900">tours exclusivos por mansiones de artistas, deportistas y personalidades destacadas</strong>, 
                    Ren√© inspira sobre decoraci√≥n, dise√±o interior y el sue√±o de la casa propia, mientras conecta con 
                    audiencias que buscan propiedades de lujo y oportunidades de inversi√≥n inmobiliaria.
                  </p>
                </>
              )}
              {language === 'en' && (
                <>
                  <p>
                    <strong class="text-gray-900">Ren√© Castillo has positioned himself as the most recognized real estate TV host in the Dominican Republic</strong>, 
                    taking viewers inside the most exclusive homes of celebrities and public figures in the country.
                  </p>
                  <p>
                    With <strong class="text-gray-900">18 years of television experience, 600K+ social media followers, 
                    and a YouTube channel with 200K+ subscribers and millions of views</strong>, Ren√© uniquely combines 
                    entertainment and real estate in the Dominican market.
                  </p>
                  <p>
                    Through <strong class="text-gray-900">exclusive tours of mansions owned by artists, athletes, and notable personalities</strong>, 
                    Ren√© inspires audiences about decoration, interior design, and homeownership dreams, while connecting with 
                    viewers seeking luxury properties and real estate investment opportunities.
                  </p>
                </>
              )}
              {language === 'fr' && (
                <>
                  <p>
                    <strong class="text-gray-900">Ren√© Castillo s'est positionn√© comme le pr√©sentateur immobilier le plus reconnu de R√©publique Dominicaine</strong>, 
                    emmenant les t√©l√©spectateurs √† l'int√©rieur des maisons les plus exclusives de c√©l√©brit√©s et figures publiques du pays.
                  </p>
                  <p>
                    Avec <strong class="text-gray-900">18 ans d'exp√©rience t√©l√©visuelle, 600K+ abonn√©s sur les r√©seaux sociaux 
                    et une cha√Æne YouTube avec 200K+ abonn√©s et des millions de vues</strong>, Ren√© combine de mani√®re unique 
                    divertissement et immobilier sur le march√© dominicain.
                  </p>
                  <p>
                    √Ä travers <strong class="text-gray-900">des visites exclusives de demeures d'artistes, sportifs et personnalit√©s notables</strong>, 
                    Ren√© inspire les audiences sur la d√©coration, le design d'int√©rieur et le r√™ve de la maison propre, tout en 
                    se connectant avec des spectateurs recherchant des propri√©t√©s de luxe et opportunit√©s d'investissement immobilier.
                  </p>
                </>
              )}
            </div>
            
            <!-- Achievement Stats para Ren√© -->
            <div class="grid grid-cols-3 gap-4 mt-8 pt-8 border-t border-gray-200">
              <div class="text-center">
                <div class="text-2xl font-bold text-[#f04e00]">18+</div>
                <div class="text-sm text-gray-600">A√±os TV</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-[#f04e00]">600K+</div>
                <div class="text-sm text-gray-600">Seguidores</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-[#f04e00]">200K+</div>
                <div class="text-sm text-gray-600">YouTube</div>
              </div>
            </div>
          </div>
          
          <div class="relative">
            <div class="aspect-[4/3] rounded-2xl overflow-hidden shadow-2xl">
              <a 
                href={language === 'es' ? '/asesores/rene-castillo' : 
                      language === 'en' ? '/advisors/rene-castillo' :
                      '/fr/conseillers/rene-castillo'}
                class="block w-full h-full group relative"
              >
                <img 
                  src="https://pacewqgypevfgjmdsorz.supabase.co/storage/v1/object/public/public-assets/images/rene%20castillo%20-clic%20con%20placa.png" 
                  alt={`${language === 'es' ? 'Ren√© Castillo con placa de YouTube de 200K suscriptores, presentador de TV y fundador de CLIC Inmobiliaria' : 
                         language === 'en' ? 'Ren√© Castillo with YouTube 200K subscribers plaque, TV host and founder of CLIC Real Estate' : 
                         'Ren√© Castillo avec plaque YouTube 200K abonn√©s, pr√©sentateur TV et fondateur de CLIC Immobilier'}`}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                />
                <!-- Overlay siempre visible -->
                <div class="absolute bottom-4 left-4 bg-white/95 rounded-lg px-4 py-2 shadow-lg">
                  <div class="flex items-center gap-2 text-sm font-semibold text-gray-800">
                    <span>{language === 'es' ? 'Ver Perfil Completo' : language === 'en' ? 'View Full Profile' : 'Voir Profil Complet'}</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
                    </svg>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- 4. Video Gallery - CUARTO (Engagement) -->
  {featuredVideos && featuredVideos.length > 0 && (
    <VideoGallery 
      videos={featuredVideos}
      title={language === 'es' ? `Canal Inmobiliario de ${countryName}` : 
             language === 'en' ? `${countryName} Real Estate Channel` : 
             `Cha√Æne Immobili√®re de ${countryName}`}
      subtitle={isDefaultCountry 
        ? (language === 'es' ? "De casas de famosos a consejos de inversi√≥n - 200K+ suscriptores nos respaldan" :
           language === 'en' ? "From celebrity homes to investment advice - 200K+ subscribers support us" :
           "Des maisons de c√©l√©brit√©s aux conseils d'investissement - 200K+ abonn√©s nous soutiennent")
        : (language === 'es' ? `Contenido experto y consejos locales para ${countryName}` :
           language === 'en' ? `Expert content and local advice for ${countryName}` :
           `Contenu expert et conseils locaux pour ${countryName}`)}
      layout="featured"
      language={language}
      countryContext={{
        code: countryCode,
        showFounder: isDefaultCountry
      }}
    />
  )}

  <!-- 5. Testimonials - QUINTO (Validaci√≥n social) -->
  {testimonials && testimonials.length > 0 && (
    <Testimonials 
      testimonials={testimonials}
      title={testimonialsSection?.title}
      subtitle={isDefaultCountry 
        ? (language === 'es' ? "La credibilidad y profesionalismo de Ren√© se refleja en cada transacci√≥n" :
           language === 'en' ? "Ren√©'s credibility and professionalism is reflected in every transaction" :
           "La cr√©dibilit√© et le professionnalisme de Ren√© se refl√®tent dans chaque transaction")
        : (language === 'es' ? `Clientes satisfechos en ${countryName} conf√≠an en nuestro equipo` :
           language === 'en' ? `Satisfied clients in ${countryName} trust our team` :
           `Clients satisfaits en ${countryName} font confiance √† notre √©quipe`)}
      language={language}
      countryContext={{
        code: countryCode,
        averageRating: testimonialsSection?.countryContext?.averageRating
      }}
    />
  )}

  <!-- 6. Team/Advisors - SEXTO (Confianza) - DISE√ëO MODERNO Y RECTANGULAR -->
  {featuredAdvisors && featuredAdvisors.length > 0 && (
    <section class="py-16 bg-gradient-to-b from-gray-50 to-white">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
            {advisorsSection?.title || (
              language === 'es' ? 'Nuestro Equipo Experto' :
              language === 'en' ? 'Our Expert Team' :
              'Notre √âquipe d\'Experts'
            )}
          </h2>
          <p class="text-lg text-gray-600 max-w-3xl mx-auto">
            {language === 'es' ? `Profesionales especializados que te brindan asesor√≠a experta y personalizada` :
             language === 'en' ? `Specialized professionals who provide you with expert and personalized advice` :
             `Professionnels sp√©cialis√©s qui vous fournissent des conseils d'experts et personnalis√©s`}
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          {featuredAdvisors.map((advisor) => (
            <div class="group relative bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-500 overflow-hidden border border-gray-100 hover:border-gray-200">
              
              {/* Efecto de gradiente sutil en hover */}
              <div class="absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-gray-50/50 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              
              <div class="relative p-6 flex items-start gap-6">
                
                {/* Avatar rectangular m√°s moderno */}
                <div class="relative flex-shrink-0">
                  <div class="w-24 h-24 md:w-28 md:h-28 rounded-2xl overflow-hidden ring-2 ring-gray-100 group-hover:ring-gray-200 transition-all duration-300">
                    <img 
                      src={getAvatarUrl(advisor.avatar)} 
                      alt={advisor.name}
                      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    />
                  </div>
                  
                  {/* Badge moderno para Ren√© */}
                  {advisor.name === 'Ren√© Castillo' && (
                    <div class="absolute -top-2 -right-2 bg-gradient-to-r from-[#f04e00] to-[#ff6b35] text-white px-2 py-1 rounded-lg text-xs font-semibold shadow-lg">
                      {language === 'es' ? 'CEO' : language === 'en' ? 'CEO' : 'PDG'}
                    </div>
                  )}
                  
                  {/* Indicador de rating */}
                  <div class="absolute -bottom-2 -right-2 bg-amber-400 text-white text-xs font-bold w-7 h-7 rounded-full flex items-center justify-center shadow-lg">
                    {advisor.clientSatisfaction}
                  </div>
                </div>

                {/* Contenido principal */}
                <div class="flex-1 min-w-0">
                  
                  {/* Header con nombre y posici√≥n */}
                  <div class="mb-3">
                    <h3 class="text-xl font-bold text-gray-900 mb-1 group-hover:text-gray-800 transition-colors">
                      {advisor.name}
                    </h3>
                    <p class="text-sm font-medium text-[#f04e00] mb-2">
                      {advisor.position}
                    </p>
                    
                    {/* Estad√≠sticas inline m√°s elegantes */}
                    <div class="flex items-center gap-4 text-xs text-gray-500">
                      {advisor.yearsExperience > 0 && (
                        <span class="flex items-center gap-1">
                          <div class="w-1.5 h-1.5 bg-blue-400 rounded-full"></div>
                          {advisor.yearsExperience} a√±os exp.
                        </span>
                      )}
                      {advisor.totalSales > 0 && (
                        <span class="flex items-center gap-1">
                          <div class="w-1.5 h-1.5 bg-emerald-400 rounded-full"></div>
                          {advisor.totalSales} operaciones
                        </span>
                      )}
                      <span class="flex items-center gap-1">
                        <div class="w-1.5 h-1.5 bg-amber-400 rounded-full"></div>
                        {advisor.clientSatisfaction}‚òÖ rating
                      </span>
                    </div>
                  </div>
                  
                  {/* Bio m√°s compacta */}
                  <p class="text-sm text-gray-600 line-clamp-2 leading-relaxed mb-4">
                    {stripHtmlTags(advisor.bio || advisor.description || '').substring(0, 120)}
                    {stripHtmlTags(advisor.bio || advisor.description || '').length > 120 ? '...' : ''}
                  </p>
                  
                  {/* Footer con idiomas y acciones */}
                  <div class="flex items-center justify-between">
                    
                    {/* Idiomas compactos */}
                    {advisor.languages && advisor.languages.length > 0 && (
                      <div class="flex gap-1">
                        {advisor.languages.slice(0, 2).map((lang: string) => (
                          <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-md font-medium">
                            {lang === 'Espa√±ol' ? 'ES' : lang === 'Ingl√©s' ? 'EN' : lang.substring(0, 2).toUpperCase()}
                          </span>
                        ))}
                        {advisor.languages.length > 2 && (
                          <span class="text-xs text-gray-400 px-1 py-1">
                            +{advisor.languages.length - 2}
                          </span>
                        )}
                      </div>
                    )}
                    
                    {/* Acciones discretas */}
                    <div class="flex items-center gap-3">
                      {advisor.url && (
                        <a 
                          href={advisor.url}
                          class="text-gray-600 hover:text-[#f04e00] text-sm font-medium flex items-center gap-1 transition-colors"
                        >
                          <span>{language === 'es' ? 'Perfil' : language === 'en' ? 'Profile' : 'Profil'}</span>
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                          </svg>
                        </a>
                      )}
                      
                      {advisor.whatsapp && (
                        <a 
                          href={`https://wa.me/${advisor.whatsapp.replace(/[^\d]/g, '')}?text=${encodeURIComponent(
                            language === 'es' ? `Hola ${advisor.name}, vi tu perfil y me interesa recibir asesor√≠a` :
                            language === 'en' ? `Hello ${advisor.name}, I saw your profile and I'm interested in receiving advice` :
                            `Bonjour ${advisor.name}, j'ai vu votre profil et je suis int√©ress√© √† recevoir des conseils`
                          )}`}
                          target="_blank"
                          class="inline-flex items-center gap-1.5 bg-gray-900 hover:bg-gray-800 text-white text-xs px-3 py-2 rounded-lg transition-colors font-medium shadow-sm hover:shadow-md"
                        >
                          <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.309"/>
                          </svg>
                          <span>Chat</span>
                        </a>
                      )}
                    </div>
                  </div>
                </div>
              </div>
              
              {/* L√≠nea de acento sutil */}
              <div class="h-1 bg-gradient-to-r from-gray-100 via-[#f04e00]/20 to-gray-100 group-hover:via-[#f04e00]/40 transition-all duration-500"></div>
            </div>
          ))}
        </div>
        
        {/* Indicador de m√°s asesores si existen */}
        {featuredAdvisors.length >= 4 && (
          <div class="text-center mt-8">
            <p class="text-sm text-gray-500 mb-4">
              {language === 'es' ? 'Mostrando algunos de nuestros especialistas' : 
               language === 'en' ? 'Showing some of our specialists' : 
               'Affichage de quelques-uns de nos sp√©cialistes'}
            </p>
            <a 
              href={language === 'es' ? '/asesores' : 
                    language === 'en' ? '/en/advisors' : 
                    '/fr/conseillers'}
              class="inline-flex items-center gap-2 text-[#f04e00] hover:text-[#d94400] font-medium transition-colors"
            >
              <span>
                {language === 'es' ? 'Ver todo el equipo' : 
                 language === 'en' ? 'View full team' : 
                 'Voir toute l\'√©quipe'}
              </span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
              </svg>
            </a>
          </div>
        )}
      </div>
    </section>
  )}

  <!-- 7. Blog Articles - S√âPTIMO (SEO + expertise) -->
  {featuredArticles && featuredArticles.length > 0 && (
    <RelatedArticles 
      articles={featuredArticles}
      title={language === 'es' ? `Centro de Conocimiento de ${countryName}` : 
             language === 'en' ? `${countryName} Knowledge Center` : 
             `Centre de Connaissances de ${countryName}`}
      subtitle={isDefaultCountry 
        ? (language === 'es' ? "Gu√≠as, an√°lisis y consejos escritos por Ren√© y su equipo de expertos" :
           language === 'en' ? "Guides, analysis and advice written by Ren√© and his team of experts" :
           "Guides, analyses et conseils √©crits par Ren√© et son √©quipe d'experts")
        : (language === 'es' ? `Contenido experto sobre el mercado inmobiliario de ${countryName}` :
           language === 'en' ? `Expert content about ${countryName}'s real estate market` :
           `Contenu expert sur le march√© immobilier de ${countryName}`)}
      layout="featured"
      language={language}
      countryContext={{
        code: countryCode,
        showFounder: isDefaultCountry
      }}
    />
  )}

  <!-- 8. FAQs - OCTAVO (Antes del CTA final) -->
  {faqs && faqs.length > 0 && (
    <DynamicFAQs 
      faqs={faqs}
      language={language}
      title={faqsSection?.title || (
        language === 'es' ? 'Preguntas Frecuentes - Rep√∫blica Dominicana' :
        language === 'en' ? 'Frequently Asked Questions - Dominican Republic' :
        'Questions Fr√©quemment Pos√©es - R√©publique Dominicaine'
      )}
      context={enhancedContext}
    />
  )}

  <!-- 9. CTA Section - NOVENO (Conversi√≥n final) -->
  <section class="py-16 bg-gradient-to-r from-[#f04e00] to-[#ff7a3d]">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
        {language === 'es' ? `¬øListo para encontrar tu propiedad ideal en ${countryName}?` : 
         language === 'en' ? `Ready to find your ideal property in ${countryName}?` : 
         `Pr√™t √† trouver votre propri√©t√© id√©ale en ${countryName}?`}
      </h2>
      <p class="text-xl text-white/90 mb-8 max-w-3xl mx-auto">
        {isDefaultCountry 
          ? (language === 'es' ? "√önete a las miles de familias que han confiado en Ren√© Castillo y CLIC Inmobiliaria para encontrar su hogar perfecto" :
             language === 'en' ? "Join thousands of families who have trusted Ren√© Castillo and CLIC Real Estate to find their perfect home" :
             "Rejoignez les milliers de familles qui ont fait confiance √† Ren√© Castillo et CLIC Immobilier pour trouver leur maison parfaite")
          : (language === 'es' ? `√önete a las familias que han confiado en ${companyName} para encontrar su hogar perfecto en ${countryName}` :
             language === 'en' ? `Join families who have trusted ${companyName} to find their perfect home in ${countryName}` :
             `Rejoignez les familles qui ont fait confiance √† ${companyName} pour trouver leur maison parfaite en ${countryName}`)}
      </p>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
        <a 
          href={language === 'es' ? '/contacto' : `/${language}/contact`}
          class="inline-flex items-center gap-2 px-8 py-4 bg-white text-[#f04e00] rounded-xl hover:bg-gray-100 transition-colors font-semibold text-lg shadow-lg"
        >
          <i class="fas fa-comments text-lg"></i>
          {language === 'es' ? "Hablar con Nuestro Equipo" : 
           language === 'en' ? "Talk to Our Team" : 
           "Parler √† Notre √âquipe"}
        </a>
        {globalConfig?.contact?.whatsapp && (
          <a 
            href={`https://wa.me/${globalConfig.contact.whatsapp.replace(/[^\d]/g, '')}?text=${encodeURIComponent(
              language === 'es' ? `Hola, vi la p√°gina de ${companyName} y me interesa conocer m√°s sobre propiedades en ${countryName}` :
              language === 'en' ? `Hello, I saw the ${companyName} website and I'm interested in learning more about properties in ${countryName}` :
              `Bonjour, j'ai vu le site web de ${companyName} et je suis int√©ress√© √† en savoir plus sur les propri√©t√©s en ${countryName}`
            )}`}
            target="_blank"
            class="inline-flex items-center gap-2 px-8 py-4 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors font-semibold text-lg shadow-lg"
          >
            <i class="fab fa-whatsapp text-lg"></i>
            WhatsApp
          </a>
        )}
      </div>
      
      <!-- Contact Info espec√≠fico del pa√≠s -->
      <div class="flex flex-col sm:flex-row items-center justify-center gap-6 text-white/80">
        {globalConfig?.contact?.phone && (
          <span class="flex items-center gap-2">
            <i class="fas fa-phone text-sm"></i>
            {globalConfig.contact.phone}
          </span>
        )}
        {globalConfig?.contact?.address && (
          <span class="flex items-center gap-2">
            <i class="fas fa-map-marker-alt text-sm"></i>
            {globalConfig.contact.address}
          </span>
        )}
        {globalConfig?.office?.hours?.weekdays && (
          <span class="flex items-center gap-2">
            <i class="fas fa-clock text-sm"></i>
            {globalConfig.office.hours.weekdays}
          </span>
        )}
      </div>
    </div>
  </section>

  <!-- Schema.org diferenciado por pa√≠s usando datos del handler -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "RealEstateAgent",
    "name": companyName,
    "legalName": globalConfig?.legal?.company_full_name || companyName,
    "alternateName": heroConfig.tagline,
    "founder": isDefaultCountry ? {
      "@type": "Person",
      "name": "Ren√© Castillo",
      "jobTitle": language === 'es' ? "Fundador y Presentador de TV" : 
                  language === 'en' ? "Founder and TV Host" : 
                  "Fondateur et Pr√©sentateur TV",
      "description": language === 'es' ? "Presentador dominicano con 18 a√±os de experiencia en televisi√≥n y 6 a√±os fundando empresas de bienes ra√≠ces" :
                     language === 'en' ? "Dominican TV host with 18 years of television experience and 6 years founding real estate companies" :
                     "Pr√©sentateur dominicain avec 18 ans d'exp√©rience t√©l√©vision et 6 ans fondant des entreprises immobili√®res"
    } : {
      "@type": "Person",
      "name": founderName,
      "jobTitle": language === 'es' ? "Experto Inmobiliario Local" : 
                  language === 'en' ? "Local Real Estate Expert" : 
                  "Expert Immobilier Local"
    },
    "description": seoData.description,
    "url": seoData.canonical_url || layoutProps.canonical,
    "telephone": globalConfig?.contact?.phone,
    "email": globalConfig?.contact?.email,
    "address": {
      "@type": "PostalAddress",
      "addressLocality": countryName,
      "addressCountry": countryCode
    },
    "areaServed": {
      "@type": "Country",
      "name": countryName
    },
    "aggregateRating": quickStats.averageRating ? {
      "@type": "AggregateRating",
      "ratingValue": quickStats.averageRating.toString(),
      "reviewCount": testimonials.length.toString(),
      "bestRating": "5",
      "worstRating": "1"
    } : undefined,
    "numberOfEmployees": quickStats.totalAdvisors || 1
  })} />
</Layout>

<style>
  .line-clamp-4 {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>