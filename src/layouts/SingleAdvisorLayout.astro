---
// src/layouts/SingleAdvisorLayout.astro - Layout para asesor individual con validación defensiva
import Layout from './Layout.astro';
import PropertyCarousel from '../components/PropertyCarousel.astro';
import Testimonials from '../components/Testimonials.astro';

// ===================================================================
// FUNCIONES HELPER PARA VALIDACIÓN DEFENSIVA
// ===================================================================

function safeGet(obj, path, defaultValue = null) {
  try {
    return path.split('.').reduce((current, key) => current && current[key], obj) || defaultValue;
  } catch (error) {
    console.warn('safeGet error:', error, 'path:', path);
    return defaultValue;
  }
}

function safeArray(arr, defaultValue = []) {
  return Array.isArray(arr) ? arr : defaultValue;
}

function safeString(str, defaultValue = '') {
  return typeof str === 'string' ? str : defaultValue;
}

function safeObject(obj, defaultValue = {}) {
  return obj && typeof obj === 'object' && !Array.isArray(obj) ? obj : defaultValue;
}

function safeNumber(num, defaultValue = 0) {
  return typeof num === 'number' && !isNaN(num) ? num : defaultValue;
}

// ===================================================================
// EXTRACCIÓN DE DATOS DEL PROP CON VALIDACIÓN DEFENSIVA
// ===================================================================

const { data } = Astro.props;
const language = safeString(data?.language, 'es');
const advisorSlug = safeString(data?.advisorSlug || data?.slug, Astro.url.pathname.split('/').pop() || 'asesor');

// ===================================================================
// PROCESAMIENTO DEFENSIVO DE DATOS
// ===================================================================

let advisorData = safeObject(data);

// Crear datos seguros del asesor
const rawAdvisor = safeObject(advisorData.advisor);
const safeAdvisor = {
  slug: safeString(rawAdvisor.slug || advisorSlug, 'asesor-inmobiliario'),
  name: safeString(rawAdvisor.name, 
    language === 'es' ? 'Asesor Inmobiliario' :
    language === 'en' ? 'Real Estate Advisor' :
    'Conseiller Immobilier'),
  title: safeString(rawAdvisor.title || rawAdvisor.position,
    language === 'es' ? 'Especialista Inmobiliario' :
    language === 'en' ? 'Real Estate Specialist' :
    'Spécialiste Immobilier'),
  avatar: safeString(rawAdvisor.avatar || rawAdvisor.profile_photo_url, 'https://i.pravatar.cc/400?img=1'),
  coverImage: safeString(rawAdvisor.coverImage, 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=1200&h=400&fit=crop'),
  specialties: safeArray(rawAdvisor.specialties, [
    language === 'es' ? 'Propiedades Residenciales' : language === 'en' ? 'Residential Properties' : 'Propriétés Résidentielles',
    language === 'es' ? 'Asesoría Personalizada' : language === 'en' ? 'Personalized Advisory' : 'Conseil Personnalisé'
  ]),
  areas: safeArray(rawAdvisor.areas || rawAdvisor.zones, ['Santo Domingo']),
  languages: safeArray(rawAdvisor.languages, [
    language === 'es' ? 'Español' : language === 'en' ? 'Spanish' : 'Espagnol'
  ]),
  experience: safeString(rawAdvisor.experience, '5 años'),
  totalSales: safeString(rawAdvisor.totalSales || rawAdvisor.total_sales, '$5M'),
  propertiesSold: safeNumber(rawAdvisor.propertiesSold || rawAdvisor.properties_sold, 50),
  avgDays: safeNumber(rawAdvisor.avgDays || rawAdvisor.avg_days, 45),
  rating: safeNumber(rawAdvisor.rating, 4.5),
  reviewCount: safeNumber(rawAdvisor.reviewCount || rawAdvisor.review_count, 25),
  phone: safeString(rawAdvisor.phone, '+1 809 555 0100'),
  whatsapp: safeString(rawAdvisor.whatsapp, '18095550100'),
  email: safeString(rawAdvisor.email, 'asesor@clic.do'),
  joinDate: safeString(rawAdvisor.joinDate || rawAdvisor.join_date, '2020-01-01'),
  bio: safeString(rawAdvisor.bio,
    language === 'es' ? `Especialista inmobiliario comprometido con brindar el mejor servicio a mis clientes. Mi objetivo es ayudarte a encontrar la propiedad perfecta que se ajuste a tus necesidades y presupuesto.

Con experiencia en el mercado dominicano, entiendo las particularidades de cada zona y puedo guiarte a través de todo el proceso de compra o venta con total transparencia y profesionalismo.

Mi enfoque se basa en la confianza, comunicación clara y resultados excepcionales. Cada cliente es único y merece una atención personalizada para lograr sus objetivos inmobiliarios.` :
    language === 'en' ? `Real estate specialist committed to providing the best service to my clients. My goal is to help you find the perfect property that fits your needs and budget.

With experience in the Dominican market, I understand the particularities of each area and can guide you through the entire buying or selling process with complete transparency and professionalism.

My approach is based on trust, clear communication and exceptional results. Each client is unique and deserves personalized attention to achieve their real estate goals.` :
    `Spécialiste immobilier engagé à fournir le meilleur service à mes clients. Mon objectif est de vous aider à trouver la propriété parfaite qui correspond à vos besoins et votre budget.

Avec de l'expérience sur le marché dominicain, je comprends les particularités de chaque zone et peux vous guider tout au long du processus d'achat ou de vente avec une transparence et un professionnalisme complets.

Mon approche est basée sur la confiance, une communication claire et des résultats exceptionnels. Chaque client est unique et mérite une attention personnalisée pour atteindre ses objectifs immobiliers.`),
  achievements: safeArray(rawAdvisor.achievements, []),
  expertise: safeArray(rawAdvisor.expertise, []),
  certifications: safeArray(rawAdvisor.certifications, [
    language === 'es' ? 'Asesor Inmobiliario Certificado' : language === 'en' ? 'Certified Real Estate Advisor' : 'Conseiller Immobilier Certifié'
  ]),
  socialProof: safeObject(rawAdvisor.socialProof, {
    linkedinFollowers: '500+',
    instagramFollowers: '1K+',
    youtubeSubscribers: '200+'
  }),
  schedule: safeObject(rawAdvisor.schedule, {
    monday: { start: '08:00', end: '18:00', available: true },
    tuesday: { start: '08:00', end: '18:00', available: true },
    wednesday: { start: '08:00', end: '18:00', available: true },
    thursday: { start: '08:00', end: '18:00', available: true },
    friday: { start: '08:00', end: '18:00', available: true },
    saturday: { start: '09:00', end: '15:00', available: true },
    sunday: { start: null, end: null, available: false }
  })
};

// Procesar ventas recientes de forma defensiva
const rawRecentSales = safeArray(advisorData.recentSales);
const safeRecentSales = rawRecentSales.map((sale, index) => ({
  id: safeString(sale.id, `sale-${index}`),
  slug: safeString(sale.slug, `venta-${index}`),
  titulo: safeString(sale.titulo || sale.title, 'Propiedad vendida'),
  precio: safeString(sale.precio || sale.price, '$0'),
  imagen: safeString(sale.imagen || sale.image || sale.featuredImage, 
    'https://images.unsplash.com/photo-1613977257363-707ba9348227?w=800&h=600&fit=crop'),
  sector: safeString(sale.sector || sale.location, 'Santo Domingo'),
  habitaciones: safeNumber(sale.habitaciones || sale.bedrooms, 3),
  banos: safeNumber(sale.banos || sale.bathrooms, 2),
  metros: safeNumber(sale.metros || sale.area, 150),
  tipo: safeString(sale.tipo || sale.type, 'Propiedad'),
  fechaVenta: safeString(sale.fechaVenta || sale.saleDate, new Date().toISOString()),
  cliente: safeString(sale.cliente || sale.client, 'Cliente satisfecho'),
  destacado: Boolean(sale.destacado || sale.featured)
}));

// Procesar propiedades actuales de forma defensiva
const rawCurrentListings = safeArray(advisorData.currentListings);
const safeCurrentListings = rawCurrentListings.map((property, index) => ({
  id: safeString(property.id, `listing-${index}`),
  slug: safeString(property.slug, `propiedad-${index}`),
  titulo: safeString(property.titulo || property.title, 'Propiedad disponible'),
  precio: safeString(property.precio || property.price, '$0'),
  imagen: safeString(property.imagen || property.image || property.featuredImage,
    'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800&h=600&fit=crop'),
  sector: safeString(property.sector || property.location, 'Santo Domingo'),
  habitaciones: safeNumber(property.habitaciones || property.bedrooms, 3),
  banos: safeNumber(property.banos || property.bathrooms, 2),
  metros: safeNumber(property.metros || property.area, 150),
  tipo: safeString(property.tipo || property.type, 'Propiedad'),
  destacado: Boolean(property.destacado || property.featured),
  nuevo: Boolean(property.nuevo || property.isNew),
  exclusiva: Boolean(property.exclusiva || property.exclusive)
}));

// Procesar testimonios de forma defensiva
const rawTestimonials = safeArray(advisorData.testimonials);
const safeTestimonials = rawTestimonials.map((testimonial, index) => ({
  id: safeString(testimonial.id, `testimonial-${index}`),
  slug: safeString(testimonial.slug, `testimonio-${index}`),
  category: safeString(testimonial.category, 'clientes'),
  author: safeObject(testimonial.author, {
    name: 'Cliente Satisfecho',
    avatar: 'https://i.pravatar.cc/150?img=1',
    location: 'Santo Domingo',
    verified: true
  }),
  rating: safeNumber(testimonial.rating, 5),
  text: safeString(testimonial.text, 
    language === 'es' ? 'Excelente servicio y atención personalizada. Muy recomendado.' :
    language === 'en' ? 'Excellent service and personalized attention. Highly recommended.' :
    'Excellent service et attention personnalisée. Hautement recommandé.'),
  excerpt: safeString(testimonial.excerpt, 
    language === 'es' ? 'Excelente servicio y atención personalizada.' :
    language === 'en' ? 'Excellent service and personalized attention.' :
    'Excellent service et attention personnalisée.'),
  propertyType: safeString(testimonial.propertyType, 'Propiedad'),
  location: safeString(testimonial.location, 'Santo Domingo'),
  date: safeString(testimonial.date, new Date().toISOString()),
  featured: Boolean(testimonial.featured),
  views: safeString(testimonial.views, '1K'),
  readTime: safeString(testimonial.readTime, '2 min')
}));

// SEO seguro
const safeSeo = {
  title: safeString(safeGet(advisorData, 'seo.title'), 
    `${safeAdvisor.name} - ${safeAdvisor.title} | CLIC Inmobiliaria`),
  description: safeString(safeGet(advisorData, 'seo.description'),
    language === 'es' ? `Conoce a ${safeAdvisor.name}, especialista inmobiliario con experiencia en el mercado dominicano` :
    language === 'en' ? `Meet ${safeAdvisor.name}, real estate specialist with experience in the Dominican market` :
    `Rencontrez ${safeAdvisor.name}, spécialiste immobilier avec expérience sur le marché dominicain`)
};

// Calcular años de experiencia
const yearsActive = safeAdvisor.joinDate ? 
  Math.max(1, new Date().getFullYear() - new Date(safeAdvisor.joinDate).getFullYear()) : 
  parseInt(safeAdvisor.experience?.replace(/[^0-9]/g, '') || '5');

// ===================================================================
// TEXTOS POR IDIOMA
// ===================================================================

const TEXTS = {
  es: {
    breadcrumbAdvisors: 'Asesores',
    aboutTitle: 'Acerca de',
    achievementsTitle: 'Logros y Reconocimientos',
    specialties: 'Especialidades',
    areas: 'Zonas de Cobertura',
    languages: 'Idiomas',
    contactInfo: 'Información de Contacto',
    expertiseTitle: 'Áreas de Expertise',
    recentSalesTitle: 'Ventas Recientes',
    currentListingsTitle: 'Propiedades Exclusivas de',
    currentListingsSubtitle: 'Propiedades premium disponibles en mi portafolio exclusivo',
    testimonialsTitle: 'Lo que dicen mis clientes',
    testimonialsSubtitle: 'Testimonios reales de clientes que han trabajado conmigo',
    certificationsTitle: 'Certificaciones y Credenciales',
    contactFormTitle: '¿Listo para trabajar conmigo?',
    contactFormSubtitle: 'Contacta directamente conmigo para una consulta personalizada',
    sendMessageTitle: 'Envíame un mensaje',
    directContactTitle: 'Contacto Directo',
    directContactSubtitle: '¿Prefieres hablar directamente? Estoy disponible para una consulta inmediata.',
    scheduleTitle: 'Horario de Atención',
    socialTitle: 'Sígueme en Redes',
    ctaTitle: '¿Listo para encontrar tu propiedad perfecta?',
    ctaSubtitle: 'Con {experience} de experiencia y más de {properties} propiedades vendidas, estoy aquí para hacer realidad tus sueños inmobiliarios',
    ctaButton1: 'Agendar cita con',
    ctaButton2: 'Ver mis propiedades disponibles',
    experience: 'de experiencia',
    propertiesSold: 'propiedades vendidas',
    avgDays: 'Días promedio',
    yearsWithClic: 'Años con CLIC',
    callNow: 'Llamar ahora',
    whatsapp: 'WhatsApp',
    email: 'Email',
    viewProfile: 'Ver perfil completo',
    featuredSale: 'Venta Destacada',
    client: 'Cliente:',
    needHelp: '¿Necesitas ayuda?',
    helpSubtitle: 'Nuestro equipo está aquí para ayudarte a encontrar tu propiedad ideal',
    contactUs: 'Contáctanos',
    totalSales: 'Total en ventas'
  },
  en: {
    breadcrumbAdvisors: 'Advisors',
    aboutTitle: 'About',
    achievementsTitle: 'Achievements and Recognition',
    specialties: 'Specialties',
    areas: 'Coverage Areas',
    languages: 'Languages',
    contactInfo: 'Contact Information',
    expertiseTitle: 'Areas of Expertise',
    recentSalesTitle: 'Recent Sales',
    currentListingsTitle: 'Exclusive Properties of',
    currentListingsSubtitle: 'Premium properties available in my exclusive portfolio',
    testimonialsTitle: 'What my clients say',
    testimonialsSubtitle: 'Real testimonials from clients who have worked with me',
    certificationsTitle: 'Certifications and Credentials',
    contactFormTitle: 'Ready to work with me?',
    contactFormSubtitle: 'Contact me directly for a personalized consultation',
    sendMessageTitle: 'Send me a message',
    directContactTitle: 'Direct Contact',
    directContactSubtitle: 'Prefer to speak directly? I am available for an immediate consultation.',
    scheduleTitle: 'Office Hours',
    socialTitle: 'Follow me on Social',
    ctaTitle: 'Ready to find your perfect property?',
    ctaSubtitle: 'With {experience} of experience and more than {properties} properties sold, I am here to make your real estate dreams come true',
    ctaButton1: 'Schedule appointment with',
    ctaButton2: 'View my available properties',
    experience: 'of experience',
    propertiesSold: 'properties sold',
    avgDays: 'Average days',
    yearsWithClic: 'Years with CLIC',
    callNow: 'Call now',
    whatsapp: 'WhatsApp',
    email: 'Email',
    viewProfile: 'View full profile',
    featuredSale: 'Featured Sale',
    client: 'Client:',
    needHelp: 'Need help?',
    helpSubtitle: 'Our team is here to help you find your ideal property',
    contactUs: 'Contact us',
    totalSales: 'Total sales'
  },
  fr: {
    breadcrumbAdvisors: 'Conseillers',
    aboutTitle: 'À propos de',
    achievementsTitle: 'Réalisations et Reconnaissance',
    specialties: 'Spécialités',
    areas: 'Zones de Couverture',
    languages: 'Langues',
    contactInfo: 'Informations de Contact',
    expertiseTitle: 'Domaines d\'Expertise',
    recentSalesTitle: 'Ventes Récentes',
    currentListingsTitle: 'Propriétés Exclusives de',
    currentListingsSubtitle: 'Propriétés premium disponibles dans mon portefeuille exclusif',
    testimonialsTitle: 'Ce que disent mes clients',
    testimonialsSubtitle: 'Témoignages réels de clients qui ont travaillé avec moi',
    certificationsTitle: 'Certifications et Références',
    contactFormTitle: 'Prêt à travailler avec moi?',
    contactFormSubtitle: 'Contactez-moi directement pour une consultation personnalisée',
    sendMessageTitle: 'Envoyez-moi un message',
    directContactTitle: 'Contact Direct',
    directContactSubtitle: 'Préférez-vous parler directement? Je suis disponible pour une consultation immédiate.',
    scheduleTitle: 'Heures de Bureau',
    socialTitle: 'Suivez-moi sur les Réseaux',
    ctaTitle: 'Prêt à trouver votre propriété parfaite?',
    ctaSubtitle: 'Avec {experience} d\'expérience et plus de {properties} propriétés vendues, je suis ici pour réaliser vos rêves immobiliers',
    ctaButton1: 'Planifier un rendez-vous avec',
    ctaButton2: 'Voir mes propriétés disponibles',
    experience: 'd\'expérience',
    propertiesSold: 'propriétés vendues',
    avgDays: 'Jours moyens',
    yearsWithClic: 'Années avec CLIC',
    callNow: 'Appeler maintenant',
    whatsapp: 'WhatsApp',
    email: 'Email',
    viewProfile: 'Voir le profil complet',
    featuredSale: 'Vente en Vedette',
    client: 'Client:',
    needHelp: 'Besoin d\'aide?',
    helpSubtitle: 'Notre équipe est là pour vous aider à trouver votre propriété idéale',
    contactUs: 'Nous contacter',
    totalSales: 'Total des ventes'
  }
};

const text = TEXTS[language] || TEXTS.es;

// URLs según idioma
const routes = {
  es: {
    advisors: '/asesores',
    properties: '/comprar'
  },
  en: {
    advisors: '/en/advisors',
    properties: '/en/buy'
  },
  fr: {
    advisors: '/fr/conseillers',
    properties: '/fr/acheter'
  }
};

const currentRoutes = routes[language] || routes.es;

// Función para formatear fecha
function formatDate(dateString) {
  try {
    const date = new Date(dateString);
    if (isNaN(date.getTime())) {
      return language === 'en' ? 'Recent' : language === 'fr' ? 'Récent' : 'Reciente';
    }
    
    const months = {
      es: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
      en: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
      fr: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre']
    };
    
    const monthNames = months[language] || months.es;
    return `${date.getDate()} de ${monthNames[date.getMonth()]} ${date.getFullYear()}`;
  } catch (error) {
    return language === 'en' ? 'Recent' : language === 'fr' ? 'Récent' : 'Reciente';
  }
}

console.log('✅ SingleAdvisorLayout preparado con validación defensiva:', {
  language,
  advisorName: safeAdvisor.name,
  recentSalesCount: safeRecentSales.length,
  currentListingsCount: safeCurrentListings.length,
  testimonialsCount: safeTestimonials.length,
  yearsActive
});
---

<Layout 
  title={safeSeo.title}
  description={safeSeo.description}
  language={language}
>
  <!-- Breadcrumbs -->
  <section class="bg-gray-50 py-4">
    <div class="container mx-auto px-4">
      <nav class="text-sm text-gray-600">
        <a href={currentRoutes.advisors} class="hover:text-[#f04e00]">{text.breadcrumbAdvisors}</a>
        <span class="mx-2">/</span>
        <span class="text-gray-900">{safeAdvisor.name}</span>
      </nav>
    </div>
  </section>

  <!-- Header Section -->
  <section class="relative">
    <!-- Cover Image -->
    <div class="h-80 bg-gradient-to-r from-[#f04e00] to-[#ff7a3d] relative overflow-hidden">
      <img 
        src={safeAdvisor.coverImage} 
        alt="Cover"
        class="w-full h-full object-cover opacity-30"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"></div>
    </div>
    
    <!-- Profile Card - Overlapping the cover -->
    <div class="container mx-auto px-4">
      <div class="relative -mt-20">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
          <div class="flex flex-col lg:flex-row items-center lg:items-start gap-8">
            <!-- Avatar -->
            <div class="relative flex-shrink-0">
              <img 
                src={safeAdvisor.avatar} 
                alt={safeAdvisor.name}
                class="w-32 h-32 rounded-full border-6 border-white shadow-xl object-cover"
              />
              <div class="absolute -bottom-2 -right-2 bg-green-500 w-8 h-8 rounded-full border-4 border-white flex items-center justify-center">
                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
            </div>
            
            <!-- Profile Info -->
            <div class="flex-1 text-center lg:text-left">
              <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">{safeAdvisor.name}</h1>
              <p class="text-xl text-gray-600 mb-4">{safeAdvisor.title}</p>
              
              <!-- Rating -->
              <div class="flex items-center justify-center lg:justify-start gap-2 mb-4">
                <div class="flex">
                  {Array.from({length: 5}, (_, i) => (
                    <svg class={`w-5 h-5 ${i < Math.floor(safeAdvisor.rating) ? 'text-yellow-400' : 'text-gray-300'}`} fill="currentColor" viewBox="0 0 24 24" key={i}>
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  ))}
                </div>
                <span class="text-gray-600">{safeAdvisor.rating}/5</span>
                <span class="text-gray-400">•</span>
                <span class="text-gray-600">{safeAdvisor.reviewCount} reseñas</span>
              </div>
              
              <!-- Quick Stats -->
              <div class="flex flex-wrap items-center justify-center lg:justify-start gap-6 text-sm text-gray-600 mb-6">
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4 text-[#f04e00]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  {safeAdvisor.experience} {text.experience}
                </span>
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4 text-[#f04e00]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                  </svg>
                  {safeAdvisor.propertiesSold} {text.propertiesSold}
                </span>
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4 text-[#f04e00]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                  Promedio {safeAdvisor.avgDays} días
                </span>
              </div>
              
              <!-- Contact Buttons -->
              <div class="flex flex-col sm:flex-row gap-3">
                <a 
                  href={`tel:${safeAdvisor.phone}`}
                  class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-[#f04e00] text-white rounded-lg hover:bg-[#d94400] transition-colors font-medium"
                >
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                  </svg>
                  {text.callNow}
                </a>
                <a 
                  href={`https://wa.me/${safeAdvisor.whatsapp}`}
                  target="_blank"
                  class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium"
                >
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/>
                  </svg>
                  {text.whatsapp}
                </a>
                <a 
                  href={`mailto:${safeAdvisor.email}`}
                  class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                  </svg>
                  {text.email}
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="py-12 bg-white">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto">
        <div class="text-center bg-gray-50 rounded-lg p-6">
          <div class="text-3xl font-bold text-[#f04e00] mb-2">{safeAdvisor.totalSales}</div>
          <div class="text-sm text-gray-600">{text.totalSales}</div>
        </div>
        <div class="text-center bg-gray-50 rounded-lg p-6">
          <div class="text-3xl font-bold text-[#f04e00] mb-2">{safeAdvisor.propertiesSold}</div>
          <div class="text-sm text-gray-600">{text.propertiesSold}</div>
        </div>
        <div class="text-center bg-gray-50 rounded-lg p-6">
          <div class="text-3xl font-bold text-[#f04e00] mb-2">{safeAdvisor.avgDays}</div>
          <div class="text-sm text-gray-600">{text.avgDays}</div>
        </div>
        <div class="text-center bg-gray-50 rounded-lg p-6">
          <div class="text-3xl font-bold text-[#f04e00] mb-2">{yearsActive}</div>
          <div class="text-sm text-gray-600">{text.yearsWithClic}</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bio and Expertise -->
  <section class="py-12">
    <div class="container mx-auto px-4">
      <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-12">
        <!-- Bio -->
        <div class="lg:col-span-2">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">{text.aboutTitle} {safeAdvisor.name}</h2>
          <div class="prose prose-lg max-w-none">
            <div class="whitespace-pre-line text-gray-700 leading-relaxed">
              {safeAdvisor.bio}
            </div>
          </div>
          
          <!-- Achievements -->
          {safeArray(safeAdvisor.achievements).length > 0 && (
            <div class="mt-8">
              <h3 class="text-xl font-semibold text-gray-900 mb-4">{text.achievementsTitle}</h3>
              <div class="space-y-4">
                {safeArray(safeAdvisor.achievements).map((achievement, index) => (
                  <div class="flex gap-4 p-4 bg-gray-50 rounded-lg" key={index}>
                    <div class="flex-shrink-0 w-12 h-12 bg-[#f04e00] rounded-full flex items-center justify-center">
                      <span class="text-white font-bold text-sm">{safeString(achievement.year, '2024')}</span>
                    </div>
                    <div>
                      <h4 class="font-semibold text-gray-900">{safeString(achievement.title, 'Logro')}</h4>
                      <p class="text-gray-600 text-sm">{safeString(achievement.description, 'Descripción del logro')}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
        
        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Specialties -->
          <div class="bg-white border rounded-lg p-6">
            <h3 class="font-semibold text-gray-900 mb-4">{text.specialties}</h3>
            <div class="space-y-2">
              {safeArray(safeAdvisor.specialties).map((specialty, index) => (
                <span class="block bg-[#f04e00]/10 text-[#f04e00] px-3 py-2 rounded text-sm" key={index}>
                  {safeString(specialty, 'Especialidad')}
                </span>
              ))}
            </div>
          </div>
          
          <!-- Areas -->
          <div class="bg-white border rounded-lg p-6">
            <h3 class="font-semibold text-gray-900 mb-4">{text.areas}</h3>
            <div class="space-y-2">
              {safeArray(safeAdvisor.areas).map((area, index) => (
                <div class="flex items-center gap-2" key={index}>
                  <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                    <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                  </svg>
                  <span class="text-gray-700 text-sm">{safeString(area, 'Zona')}</span>
                </div>
              ))}
            </div>
          </div>
          
          <!-- Languages -->
          <div class="bg-white border rounded-lg p-6">
            <h3 class="font-semibold text-gray-900 mb-4">{text.languages}</h3>
            <div class="space-y-2">
              {safeArray(safeAdvisor.languages).map((lang, index) => (
                <div class="flex items-center gap-2" key={index}>
                  <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                  </svg>
                  <span class="text-gray-700 text-sm">{safeString(lang, 'Idioma')}</span>
                </div>
              ))}
            </div>
          </div>
          
          <!-- Contact Info -->
          <div class="bg-gradient-to-r from-[#f04e00] to-[#ff7a3d] rounded-lg p-6 text-white">
            <h3 class="font-semibold mb-4">{text.contactInfo}</h3>
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
                <span class="text-sm">{safeAdvisor.phone}</span>
              </div>
              <div class="flex items-center gap-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                <span class="text-sm">{safeAdvisor.email}</span>
              </div>
              <div class="flex items-center gap-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="text-sm">Lun-Vie: 8:00-18:00<br/>Sáb: 9:00-15:00</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Expertise Bars -->
  {safeArray(safeAdvisor.expertise).length > 0 && (
    <section class="py-12 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
          <h2 class="text-2xl font-bold text-gray-900 mb-8 text-center">{text.expertiseTitle}</h2>
          
          <div class="space-y-6">
            {safeArray(safeAdvisor.expertise).map((skill, index) => (
              <div class="bg-white rounded-lg p-6" key={index}>
                <div class="flex justify-between items-center mb-2">
                  <h3 class="font-semibold text-gray-900">{safeString(skill.area, 'Área de expertise')}</h3>
                  <span class="text-[#f04e00] font-bold">{safeNumber(skill.percentage, 80)}%</span>
                </div>
                <p class="text-sm text-gray-600 mb-3">{safeString(skill.description, 'Descripción de la expertise')}</p>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div 
                    class="bg-gradient-to-r from-[#f04e00] to-[#ff7a3d] h-3 rounded-full transition-all duration-1000"
                    style={`width: ${safeNumber(skill.percentage, 80)}%`}
                  ></div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Recent Sales -->
  {safeArray(safeRecentSales).length > 0 && (
    <section class="py-12">
      <div class="container mx-auto px-4">
        <h2 class="text-2xl font-bold text-gray-900 mb-8">{text.recentSalesTitle}</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          {safeArray(safeRecentSales).map((sale, index) => (
            <div class="bg-white rounded-lg shadow-md overflow-hidden" key={sale.id || index}>
              <div class="relative">
                <img 
                  src={sale.imagen} 
                  alt={sale.titulo}
                  class="w-full aspect-video object-cover"
                />
                {sale.destacado && (
                  <span class="absolute top-3 left-3 bg-[#f04e00] text-white px-2 py-1 rounded text-xs font-medium">
                    {text.featuredSale}
                  </span>
                )}
                <div class="absolute bottom-3 right-3 bg-black/80 text-white px-2 py-1 rounded text-sm">
                  {formatDate(sale.fechaVenta)}
                </div>
              </div>
              
              <div class="p-4">
                <div class="flex justify-between items-start mb-2">
                  <span class="text-xs text-[#f04e00] bg-[#f04e00]/10 px-2 py-1 rounded">
                    {sale.tipo}
                  </span>
                  <span class="text-lg font-bold text-[#f04e00]">{sale.precio}</span>
                </div>
                
                <h3 class="font-semibold text-gray-900 mb-2">{sale.titulo}</h3>
                
                <div class="flex items-center gap-4 text-xs text-gray-600 mb-3">
                  <span>{sale.habitaciones} hab</span>
                  <span>•</span>
                  <span>{sale.banos} baños</span>
                  <span>•</span>
                  <span>{sale.metros} m²</span>
                </div>
                
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-600">{sale.sector}</span>
                  <span class="text-xs text-gray-500">{text.client} {sale.cliente}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Current Listings -->
  {safeArray(safeCurrentListings).length > 0 && (
    <PropertyCarousel 
      title={`${text.currentListingsTitle} ${safeAdvisor.name}`}
      subtitle={text.currentListingsSubtitle}
      properties={safeCurrentListings}
      viewAllLink={`${currentRoutes.properties}?asesor=${safeAdvisor.name.toLowerCase().replace(/\s+/g, '-')}`}
      language={language}
    />
  )}

  <!-- Client Testimonials -->
  {safeArray(safeTestimonials).length > 0 && (
    <Testimonials 
      testimonials={safeTestimonials}
      title={text.testimonialsTitle}
      subtitle={text.testimonialsSubtitle}
      language={language}
    />
  )}

  <!-- Certifications -->
  {safeArray(safeAdvisor.certifications).length > 0 && (
    <section class="py-12 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
          <h2 class="text-2xl font-bold text-gray-900 mb-8">{text.certificationsTitle}</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {safeArray(safeAdvisor.certifications).map((cert, index) => (
              <div class="bg-white rounded-lg p-4 border-l-4 border-[#f04e00] flex items-center gap-3" key={index}>
                <svg class="w-8 h-8 text-[#f04e00]" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="text-gray-900 font-medium">{safeString(cert, 'Certificación')}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- CTA Section -->
  <section class="py-16 bg-gradient-to-r from-[#f04e00] to-[#ff7a3d]">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
        {text.ctaTitle}
      </h2>
      <p class="text-xl text-white/90 mb-8 max-w-2xl mx-auto">
        {text.ctaSubtitle.replace('{experience}', safeAdvisor.experience).replace('{properties}', safeAdvisor.propertiesSold.toString())}
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href={`https://wa.me/${safeAdvisor.whatsapp}?text=Hola%20${safeAdvisor.name},%20quiero%20agendar%20una%20cita`}
          target="_blank"
          class="inline-block px-8 py-3 bg-white text-[#f04e00] rounded-lg hover:bg-gray-100 transition-colors font-medium"
        >
          {text.ctaButton1} {safeAdvisor.name}
        </a>
        <a 
          href={`${currentRoutes.properties}?asesor=${safeAdvisor.name.toLowerCase().replace(/\s+/g, '-')}`}
          class="inline-block px-8 py-3 bg-white/20 text-white border border-white rounded-lg hover:bg-white/30 transition-colors font-medium"
        >
          {text.ctaButton2}
        </a>
      </div>
    </div>
  </section>
</Layout>

<style>
  .transform {
    transition: transform 0.3s ease;
  }
  
  .bg-gradient-to-r {
    background-image: linear-gradient(to right, var(--tw-gradient-stops));
  }
  
  .hover\:scale-105:hover {
    transform: scale(1.05);
  }
  
  .prose {
    max-width: none;
  }
  
  .prose .whitespace-pre-line {
    white-space: pre-line;
  }
</style>