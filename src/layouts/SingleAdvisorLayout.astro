---
// src/layouts/AdvisorSingleLayout.astro - Layout para página de asesor individual
import Layout from './Layout.astro';
import PropertyCarousel from '../components/PropertyCarousel.astro';
import ArticleCard from '../components/ArticleCard.astro';

// ===================================================================
// FUNCIONES HELPER PARA VALIDACIÓN DEFENSIVA
// ===================================================================

function safeGet(obj, path, defaultValue = null) {
  try {
    return path.split('.').reduce((current, key) => current && current[key], obj) || defaultValue;
  } catch (error) {
    console.warn('safeGet error:', error, 'path:', path);
    return defaultValue;
  }
}

function safeArray(arr, defaultValue = []) {
  return Array.isArray(arr) ? arr : defaultValue;
}

function safeString(str, defaultValue = '') {
  return typeof str === 'string' ? str : defaultValue;
}

function safeObject(obj, defaultValue = {}) {
  return obj && typeof obj === 'object' && !Array.isArray(obj) ? obj : defaultValue;
}

function safeNumber(num, defaultValue = 0) {
  return typeof num === 'number' && !isNaN(num) ? num : defaultValue;
}

// ===================================================================
// EXTRACCIÓN DE DATOS DEL PROP CON VALIDACIÓN DEFENSIVA
// ===================================================================

const { data } = Astro.props;
const language = safeString(data?.language, 'es');
const advisorSlug = safeString(data?.advisorSlug || data?.slug, Astro.url.pathname.split('/').pop() || 'asesor');

// ===================================================================
// PROCESAMIENTO DEFENSIVO DE DATOS
// ===================================================================

let advisorData = safeObject(data);

// Datos del asesor
const rawAdvisor = safeObject(advisorData.advisor);
const properties = safeArray(advisorData.properties);
const testimonials = safeArray(advisorData.testimonials);
const articles = safeArray(advisorData.articles);
const stats = safeObject(advisorData.stats);
const timeline = safeArray(advisorData.timeline);
const services = safeArray(advisorData.services);
const contactMethods = safeArray(advisorData.contactMethods);

// ===================================================================
// TEXTOS Y TRADUCCIONES SEGÚN IDIOMA
// ===================================================================

const texts = {
  es: {
    metaTitle: `${rawAdvisor.name || 'Asesor'} - Asesor Inmobiliario | CLIC`,
    metaDescription: `Conoce a ${rawAdvisor.name || 'nuestro asesor'}, asesor inmobiliario experto en República Dominicana. Contáctalo para encontrar tu propiedad ideal.`,
    stats: 'Estadísticas',
    experience: 'Experiencia',
    sales: 'Ventas',
    satisfaction: 'Satisfacción',
    languages: 'Idiomas',
    specialties: 'Especialidades',
    about: 'Sobre Mí',
    properties: 'Propiedades',
    viewAll: 'Ver Todas',
    noProperties: 'No hay propiedades disponibles en este momento',
    testimonials: 'Testimonios de Clientes',
    noTestimonials: 'No hay testimonios disponibles en este momento',
    articles: 'Artículos de Blog',
    noArticles: 'No hay artículos disponibles en este momento',
    timeline: 'Trayectoria',
    services: 'Servicios',
    includedServices: 'Servicios Incluidos',
    premiumServices: 'Servicios Premium',
    contact: 'Contactar',
    contactMe: 'Contáctame',
    backToAdvisors: 'Volver a Asesores',
    readMore: 'Leer más',
    recentPosts: 'Publicaciones Recientes',
    seeAllArticles: 'Ver todos los artículos',
    viewProperty: 'Ver Propiedad',
    contactInfo: 'Información de Contacto',
    expertIn: 'Experto en',
    ctaTitle: '¿Buscas Propiedades?',
    ctaSubtitle: 'Contáctame y te ayudaré a encontrar tu propiedad ideal',
    ctaButton1: 'Contactar',
    ctaButton2: 'Ver propiedades',
    home: 'Inicio',
    advisors: 'Asesores'
  },
  en: {
    metaTitle: `${rawAdvisor.name || 'Advisor'} - Real Estate Advisor | CLIC`,
    metaDescription: `Meet ${rawAdvisor.name || 'our advisor'}, expert real estate advisor in Dominican Republic. Contact for finding your ideal property.`,
    stats: 'Statistics',
    experience: 'Experience',
    sales: 'Sales',
    satisfaction: 'Satisfaction',
    languages: 'Languages',
    specialties: 'Specialties',
    about: 'About Me',
    properties: 'Properties',
    viewAll: 'View All',
    noProperties: 'No properties available at this time',
    testimonials: 'Client Testimonials',
    noTestimonials: 'No testimonials available at this time',
    articles: 'Blog Articles',
    noArticles: 'No articles available at this time',
    timeline: 'Career Path',
    services: 'Services',
    includedServices: 'Included Services',
    premiumServices: 'Premium Services',
    contact: 'Contact',
    contactMe: 'Contact Me',
    backToAdvisors: 'Back to Advisors',
    readMore: 'Read more',
    recentPosts: 'Recent Posts',
    seeAllArticles: 'See all articles',
    viewProperty: 'View Property',
    contactInfo: 'Contact Information',
    expertIn: 'Expert in',
    ctaTitle: 'Looking for Properties?',
    ctaSubtitle: 'Contact me and I will help you find your ideal property',
    ctaButton1: 'Contact',
    ctaButton2: 'View properties',
    home: 'Home',
    advisors: 'Advisors'
  },
  fr: {
    metaTitle: `${rawAdvisor.name || 'Conseiller'} - Conseiller Immobilier | CLIC`,
    metaDescription: `Découvrez ${rawAdvisor.name || 'notre conseiller'}, conseiller immobilier expert en République Dominicaine. Contactez pour trouver votre propriété idéale.`,
    stats: 'Statistiques',
    experience: 'Expérience',
    sales: 'Ventes',
    satisfaction: 'Satisfaction',
    languages: 'Langues',
    specialties: 'Spécialités',
    about: 'À Propos de Moi',
    properties: 'Propriétés',
    viewAll: 'Voir Tout',
    noProperties: 'Pas de propriétés disponibles en ce moment',
    testimonials: 'Témoignages des Clients',
    noTestimonials: 'Pas de témoignages disponibles en ce moment',
    articles: 'Articles de Blog',
    noArticles: 'Pas d\'articles disponibles en ce moment',
    timeline: 'Parcours Professionnel',
    services: 'Services',
    includedServices: 'Services Inclus',
    premiumServices: 'Services Premium',
    contact: 'Contact',
    contactMe: 'Contactez-Moi',
    backToAdvisors: 'Retour aux Conseillers',
    readMore: 'Lire plus',
    recentPosts: 'Publications Récentes',
    seeAllArticles: 'Voir tous les articles',
    viewProperty: 'Voir Propriété',
    contactInfo: 'Informations de Contact',
    expertIn: 'Expert en',
    ctaTitle: 'Vous cherchez des propriétés?',
    ctaSubtitle: 'Contactez-moi et je vous aiderai à trouver votre propriété idéale',
    ctaButton1: 'Contacter',
    ctaButton2: 'Voir les propriétés',
    home: 'Accueil',
    advisors: 'Conseillers'
  }
};

// Seleccionar los textos según el idioma
const text = texts[language] || texts.es;

// ===================================================================
// URLS Y RUTAS
// ===================================================================

const currentRoutes = {
  home: language === 'es' ? '/' : language === 'en' ? '/en' : '/fr',
  contact: language === 'es' ? '/contacto' : language === 'en' ? '/en/contact' : '/fr/contact',
  properties: language === 'es' ? '/propiedades' : language === 'en' ? '/en/properties' : '/fr/proprietes',
  advisors: language === 'es' ? '/asesores' : language === 'en' ? '/en/advisors' : '/fr/conseillers',
  blog: language === 'es' ? '/articulos' : language === 'en' ? '/en/articles' : '/fr/articles'
};

// ===================================================================
// PREPARACIÓN DE DATOS PARA EL LAYOUT
// ===================================================================

// Obtener SEO data de manera segura
const safeSeo = safeObject(advisorData.seo, {
  title: text.metaTitle,
  description: text.metaDescription,
  canonical_url: `${currentRoutes.advisors}/${advisorSlug}`,
  breadcrumbs: [
    {
      name: text.home,
      url: currentRoutes.home
    },
    {
      name: text.advisors,
      url: currentRoutes.advisors
    },
    {
      name: rawAdvisor.name || 'Asesor',
      url: `${currentRoutes.advisors}/${advisorSlug}`
    }
  ],
  hreflang: {
    es: `https://clicinmobiliaria.com/asesores/${advisorSlug}`,
    en: `https://clicinmobiliaria.com/en/advisors/${advisorSlug}`,
    fr: `https://clicinmobiliaria.com/fr/conseillers/${advisorSlug}`
  },
  ogImage: rawAdvisor.avatar || '/og-advisor.jpg'
});

// Construir datos para Layout
const layoutProps = {
  title: safeSeo.title || text.metaTitle,
  description: safeSeo.description || text.metaDescription,
  ogImage: safeSeo.ogImage || '/og-advisor.jpg',
  canonical: safeSeo.canonical_url,
  keywords: safeSeo.keywords,
  hreflangData: safeSeo.hreflang || {},
  globalConfig: advisorData?.globalConfig || {},
  language: language,
  trackingString: advisorData?.trackingString || '',
  hotItems: advisorData?.hotItems || {},
  country: advisorData?.country || {},
  breadcrumbs: safeSeo.breadcrumbs,
  structuredData: safeSeo.structured_data,
  openGraph: safeSeo.open_graph,
  twitterCard: safeSeo.twitter_card
};

// Log de estado para debugging
console.log('✅ AdvisorSingleLayout preparado:', {
  language,
  advisorName: rawAdvisor.name,
  propertiesCount: properties.length,
  testimonialsCount: testimonials.length,
  articlesCount: articles.length
});

// ===================================================================
// FUNCIONES AUXILIARES
// ===================================================================

// Función para formatear número con separadores de miles
function formatNumber(number) {
  return new Intl.NumberFormat().format(number);
}

// Función para formatear fecha
function formatDate(dateStr, locale = language) {
  try {
    const date = new Date(dateStr);
    return new Intl.DateTimeFormat(locale === 'es' ? 'es-ES' : locale === 'fr' ? 'fr-FR' : 'en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    }).format(date);
  } catch (error) {
    console.warn('Error formatting date:', error);
    return dateStr;
  }
}

// ===================================================================
// COMPONENTE LAYOUT
// ===================================================================
---

<Layout {...layoutProps}>
  <div class="advisor-single-layout">
    
    <!-- Hero Section with Background and Advisor Info -->
    <div class="relative">
      <!-- Hero Background Image -->
      <div class="absolute inset-0 w-full h-[500px]">
        <img 
          src={rawAdvisor.coverImage || "https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?w=1920&h=600&fit=crop"} 
          alt={`${rawAdvisor.name} - Cover`}
          class="w-full h-full object-cover"
        />
        <div class="absolute inset-0 bg-gradient-to-b from-black/70 to-black/30"></div>
      </div>
      
      <!-- Advisor Profile Content -->
      <div class="container mx-auto px-4 pt-24 pb-16 relative z-10 h-[500px] flex items-center">
        <div class="flex flex-col md:flex-row items-center gap-8 mt-16">
          <!-- Avatar -->
          <div class="relative">
            <div class="w-32 h-32 md:w-40 md:h-40 rounded-full border-4 border-white overflow-hidden shadow-xl">
              <img 
                src={rawAdvisor.avatar || '/images/team/default-advisor.jpg'} 
                alt={rawAdvisor.name}
                class="w-full h-full object-cover"
              />
            </div>
          </div>
          
          <!-- Info -->
          <div class="text-white flex-1 text-center md:text-left">
            <h1 class="text-3xl md:text-4xl font-bold">{rawAdvisor.name}</h1>
            <p class="text-white/80 text-xl">{rawAdvisor.position || rawAdvisor.title}</p>
            
            <!-- Specialties Tags -->
            {safeArray(rawAdvisor.specialties).length > 0 && (
              <div class="mt-4 flex flex-wrap gap-2 justify-center md:justify-start">
                {safeArray(rawAdvisor.specialties).map(specialty => (
                  <span class="bg-white/20 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
                    {specialty}
                  </span>
                ))}
              </div>
            )}
          </div>
          
          <!-- Social & Contact -->
          <div class="flex flex-wrap gap-3 mt-4 md:mt-0 justify-center">
            {rawAdvisor.socialLinks?.facebook && (
              <a 
                href={rawAdvisor.socialLinks.facebook.startsWith('http') 
                  ? rawAdvisor.socialLinks.facebook 
                  : `https://facebook.com/${rawAdvisor.socialLinks.facebook}`}
                target="_blank" 
                rel="noopener noreferrer"
                class="w-10 h-10 rounded-full bg-gray-800/50 backdrop-blur-sm flex items-center justify-center text-white hover:bg-gray-700/50 transition-colors"
                aria-label="Facebook"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"></path>
                </svg>
              </a>
            )}
            
            {rawAdvisor.socialLinks?.instagram && (
              <a 
                href={rawAdvisor.socialLinks.instagram.startsWith('http') 
                  ? rawAdvisor.socialLinks.instagram 
                  : `https://instagram.com/${rawAdvisor.socialLinks.instagram.replace('@', '')}`}
                target="_blank" 
                rel="noopener noreferrer"
                class="w-10 h-10 rounded-full bg-gray-800/50 backdrop-blur-sm flex items-center justify-center text-white hover:bg-gray-700/50 transition-colors"
                aria-label="Instagram"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"></path>
                </svg>
              </a>
            )}
            
            {rawAdvisor.socialLinks?.twitter && (
              <a 
                href={rawAdvisor.socialLinks.twitter.startsWith('http') 
                  ? rawAdvisor.socialLinks.twitter 
                  : `https://twitter.com/${rawAdvisor.socialLinks.twitter.replace('@', '')}`}
                target="_blank" 
                rel="noopener noreferrer"
                class="w-10 h-10 rounded-full bg-gray-800/50 backdrop-blur-sm flex items-center justify-center text-white hover:bg-gray-700/50 transition-colors"
                aria-label="Twitter"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path>
                </svg>
              </a>
            )}
            
            {rawAdvisor.socialLinks?.linkedin && (
              <a 
                href={rawAdvisor.socialLinks.linkedin.startsWith('http') 
                  ? rawAdvisor.socialLinks.linkedin 
                  : `https://linkedin.com/in/${rawAdvisor.socialLinks.linkedin}`}
                target="_blank" 
                rel="noopener noreferrer"
                class="w-10 h-10 rounded-full bg-gray-800/50 backdrop-blur-sm flex items-center justify-center text-white hover:bg-gray-700/50 transition-colors"
                aria-label="LinkedIn"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path>
                </svg>
              </a>
            )}
            
            {rawAdvisor.socialLinks?.youtube && (
              <a 
                href={rawAdvisor.socialLinks.youtube}
                target="_blank" 
                rel="noopener noreferrer"
                class="w-10 h-10 rounded-full bg-gray-800/50 backdrop-blur-sm flex items-center justify-center text-white hover:bg-gray-700/50 transition-colors"
                aria-label="YouTube"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"></path>
                </svg>
              </a>
            )}
            
            {rawAdvisor.phone && (
              <a 
                href={`tel:${rawAdvisor.phone}`}
                class="bg-[#f04e00] text-white px-4 py-2 rounded-lg hover:bg-[#e04000] transition-colors flex items-center gap-2"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
                {text.contact}
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Content Section -->
    <section class="py-12 mt-[160px] md:mt-0">
      <div class="container mx-auto px-4">
        <div class="flex flex-col lg:flex-row gap-8">
          <!-- Left Column (2/3) -->
          <div class="lg:w-2/3">
            <!-- About Me Section -->
            {rawAdvisor.bio && (
              <div class="bg-white rounded-lg shadow-md p-6 md:p-8 mb-8">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">{text.about}</h2>
                <div class="text-justify leading-relaxed" set:html={rawAdvisor.bio}></div>
              </div>
            )}
            
            <!-- Stats Cards -->
            {(stats && Object.keys(stats).length > 0) && (
              <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                {rawAdvisor.yearsExperience > 0 && (
                  <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-[#f04e00] mb-1">{rawAdvisor.yearsExperience}+</div>
                    <div class="text-gray-600">{text.experience}</div>
                  </div>
                )}
                
                {rawAdvisor.stats?.totalSales > 0 && (
                  <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-[#f04e00] mb-1">{rawAdvisor.stats.totalSales}+</div>
                    <div class="text-gray-600">{text.sales}</div>
                  </div>
                )}
                
                {stats.totalProperties > 0 && (
                  <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-[#f04e00] mb-1">{stats.totalProperties}</div>
                    <div class="text-gray-600">{text.properties}</div>
                  </div>
                )}
                
                {stats.averageRating > 0 && (
                  <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-[#f04e00] mb-1">{stats.averageRating}/5</div>
                    <div class="text-gray-600">{text.satisfaction}</div>
                  </div>
                )}
              </div>
            )}
            
            <!-- Career Timeline -->
            {timeline.length > 0 && (
              <div class="bg-white rounded-lg shadow-md p-6 md:p-8 mb-8">
                <h2 class="text-2xl font-bold mb-6 border-b pb-2">{text.timeline}</h2>
                <div class="relative border-l-2 border-gray-200 pl-8 pt-2 pb-4">
                  {timeline.map((item, index) => (
                    <div class="mb-6 relative">
                      <div class="absolute -left-10 mt-1.5 w-6 h-6 rounded-full bg-[#f04e00] border-4 border-white"></div>
                      <div class="text-lg font-bold">{item.title}</div>
                      <div class="text-sm text-gray-600 mb-1">{item.year}</div>
                      <div class="text-gray-700">{item.description}</div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            <!-- Services Section -->
            {services.length > 0 && (
              <div class="bg-white rounded-lg shadow-md p-6 md:p-8 mb-8">
                <h2 class="text-2xl font-bold mb-6 border-b pb-2">{text.services}</h2>
                
                <div>
                  <!-- Included Services -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    {services.filter(service => service.included).map(service => (
                      <div class="flex bg-gray-50 p-4 rounded-lg">
                        <div class="text-[#f04e00] mr-4">
                          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                        </div>
                        <div>
                          <h3 class="font-bold text-gray-900">{service.title}</h3>
                          <p class="text-sm text-gray-600">{service.description}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <!-- Premium Services -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {services.filter(service => service.premium).map(service => (
                      <div class="flex bg-[#f04e00]/5 p-4 rounded-lg border border-[#f04e00]/20">
                        <div class="text-[#f04e00] mr-4">
                          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                          </svg>
                        </div>
                        <div>
                          <h3 class="font-bold text-gray-900">{service.title}</h3>
                          <p class="text-sm text-gray-600">{service.description}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
            
            <!-- Properties Section -->
            {properties.length > 0 && (
              <div class="mb-8">
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold">{text.properties}</h2>
                  <a href={`${currentRoutes.properties}?advisor=${rawAdvisor.slug}`} class="text-[#f04e00] font-medium hover:underline">
                    {text.viewAll}
                  </a>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {properties.slice(0, 3).map(property => (
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                      <div class="relative">
                        <img 
                          src={property.featuredImage || '/images/properties/default.jpg'} 
                          alt={property.title}
                          class="w-full h-56 object-cover"
                        />
                        <div class="absolute top-0 right-0 bg-[#f04e00] text-white px-3 py-1 m-2 rounded text-sm font-bold">
                          {property.price}
                        </div>
                      </div>
                      
                      <div class="p-4">
                        <h3 class="text-lg font-bold mb-1 truncate">{property.title}</h3>
                        <p class="text-gray-600 text-sm mb-3 truncate">{property.location}</p>
                        
                        <div class="flex justify-between items-center text-sm text-gray-600 mb-4">
                          <div class="flex items-center">
                            <svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            {property.propertyType}
                          </div>
                          
                          <div class="flex items-center">
                            <svg class="w-4 h-4 mr-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            {property.listingDate}
                          </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2 mb-4 text-center text-xs">
                          {property.bedrooms && (
                            <div class="bg-gray-50 py-2 rounded">
                              <div class="font-bold">{property.bedrooms}</div>
                              <div class="text-gray-500">Habitaciones</div>
                            </div>
                          )}
                          
                          {property.bathrooms && (
                            <div class="bg-gray-50 py-2 rounded">
                              <div class="font-bold">{property.bathrooms}</div>
                              <div class="text-gray-500">Baños</div>
                            </div>
                          )}
                          
                          {property.area && (
                            <div class="bg-gray-50 py-2 rounded">
                              <div class="font-bold">{property.area}</div>
                              <div class="text-gray-500">m²</div>
                            </div>
                          )}
                        </div>
                        
                        <a 
                          href={property.url} 
                          class="block w-full text-center py-2 px-4 bg-[#f04e00] text-white rounded hover:bg-[#d94400] transition-colors"
                        >
                          {text.viewProperty}
                        </a>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            <!-- Articles Section -->
            {articles.length > 0 && (
              <div>
                <div class="flex justify-between items-center mb-6">
                  <h2 class="text-2xl font-bold">{text.recentPosts}</h2>
                  <a href={currentRoutes.blog} class="text-[#f04e00] font-medium hover:underline">
                    {text.seeAllArticles}
                  </a>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  {articles.slice(0, 3).map(article => (
                    <a href={article.url} class="group">
                      <div class="bg-white rounded-lg overflow-hidden shadow hover:shadow-md transition-shadow">
                        <div class="relative aspect-video overflow-hidden">
                          <img 
                            src={article.featuredImage || '/images/blog/default.jpg'} 
                            alt={article.title}
                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                          />
                        </div>
                        <div class="p-4">
                          <div class="flex justify-between items-center text-xs text-gray-500 mb-2">
                            <div class="flex items-center">
                              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                              </svg>
                              {formatDate(article.publishedAt)}
                            </div>
                            {article.readTime && (
                              <div class="flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                {article.readTime}
                              </div>
                            )}
                          </div>
                          <h3 class="font-bold text-lg mb-2 group-hover:text-[#f04e00] transition-colors line-clamp-2">
                            {article.title}
                          </h3>
                          <p class="text-gray-600 text-sm line-clamp-2 mb-3">{article.excerpt}</p>
                          <div class="text-[#f04e00] text-sm font-medium flex items-center">
                            {text.readMore}
                            <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                          </div>
                        </div>
                      </div>
                    </a>
                  ))}
                </div>
              </div>
            )}
          </div>
          
          <!-- Right Column (1/3) -->
          <div class="lg:w-1/3">
            <!-- Contact Card -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
              <h2 class="text-xl font-bold mb-4">{text.contactInfo}</h2>
              
              <div class="space-y-4">
                {contactMethods.map(method => (
                  <a 
                    href={method.action} 
                    class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
                  >
                    <div class="w-10 h-10 rounded-full bg-[#f04e00]/10 flex items-center justify-center mr-3">
                      <svg class="w-5 h-5 text-[#f04e00]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                      </svg>
                    </div>
                    <div>
                      <div class="text-sm font-medium">{method.label}</div>
                      <div class="text-xs text-gray-600">{method.available}</div>
                    </div>
                  </a>
                ))}
                
                {/* Si no hay métodos de contacto, mostrar al menos uno por defecto */}
                {contactMethods.length === 0 && rawAdvisor.email && (
                  <a 
                    href={`mailto:${rawAdvisor.email}`}
                    class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
                  >
                    <div class="w-10 h-10 rounded-full bg-[#f04e00]/10 flex items-center justify-center mr-3">
                      <svg class="w-5 h-5 text-[#f04e00]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                      </svg>
                    </div>
                    <div>
                      <div class="text-sm font-medium">Enviar Email</div>
                      <div class="text-xs text-gray-600">{rawAdvisor.email}</div>
                    </div>
                  </a>
                )}
                
                {contactMethods.length === 0 && rawAdvisor.phone && (
                  <a 
                    href={`tel:${rawAdvisor.phone}`}
                    class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
                  >
                    <div class="w-10 h-10 rounded-full bg-[#f04e00]/10 flex items-center justify-center mr-3">
                      <svg class="w-5 h-5 text-[#f04e00]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                      </svg>
                    </div>
                    <div>
                      <div class="text-sm font-medium">Llamar Ahora</div>
                      <div class="text-xs text-gray-600">{rawAdvisor.phone}</div>
                    </div>
                  </a>
                )}
              </div>
            </div>
            
            <!-- Specialties & Languages Card -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
              {safeArray(rawAdvisor.specialties).length > 0 && (
                <div class="mb-6">
                  <h3 class="text-xl font-bold mb-3">{text.specialties}</h3>
                  <div class="flex flex-wrap gap-2">
                    {safeArray(rawAdvisor.specialties).map(specialty => (
                      <span class="inline-flex px-3 py-1 rounded-full bg-[#f04e00]/10 text-[#f04e00] text-sm">
                        {specialty}
                      </span>
                    ))}
                  </div>
                </div>
              )}
              
              {safeArray(rawAdvisor.languages).length > 0 && (
                <div>
                  <h3 class="text-xl font-bold mb-3">{text.languages}</h3>
                  <div class="flex flex-wrap gap-2">
                    {safeArray(rawAdvisor.languages).map(lang => (
                      <span class="inline-flex px-3 py-1 rounded-full bg-gray-100 text-gray-800 text-sm">
                        {lang}
                      </span>
                    ))}
                  </div>
                </div>
              )}
            </div>
            
            <!-- Client Testimonials -->
            {testimonials.length > 0 && (
              <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-bold mb-4">{text.testimonials}</h2>
                <div class="space-y-4">
                  {testimonials.slice(0, 3).map(testimonial => (
                    <div class="bg-gray-50 p-5 rounded-lg shadow-sm relative">
                      <div class="absolute top-2 right-3 text-5xl text-[#f04e00]/10 font-serif">
                        &ldquo;
                      </div>
                      
                      {/* Rating Stars */}
                      <div class="flex mb-3">
                        {[...Array(testimonial.rating || 5)].map(() => (
                          <svg class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>
                          </svg>
                        ))}
                      </div>
                      
                      {/* Testimonial Title */}
                      {testimonial.title && (
                        <h3 class="font-bold text-lg mb-2">{testimonial.title}</h3>
                      )}
                      
                      {/* Testimonial Content */}
                      <div class="text-gray-700 text-sm mb-4" set:html={testimonial.excerpt || testimonial.full_testimonial || ''}></div>
                      
                      {/* Client Info */}
                      <div class="flex items-center mt-2">
                        {testimonial.clientAvatar && (
                          <img 
                            src={testimonial.clientAvatar} 
                            alt={testimonial.clientName}
                            class="w-10 h-10 rounded-full object-cover mr-3"
                          />
                        )}
                        <div>
                          <div class="font-medium">{testimonial.clientName}</div>
                          {testimonial.clientLocation && (
                            <div class="text-xs text-gray-500">{testimonial.clientLocation}</div>
                          )}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </section>
    
    <!-- CTA Section -->
    <section class="py-16 bg-[#f04e00]">
      <div class="container mx-auto px-4 text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
          {text.ctaTitle}
        </h2>
        <p class="text-xl text-white/90 mb-8 max-w-2xl mx-auto">
          {text.ctaSubtitle}
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          {rawAdvisor.phone && (
            <a 
              href={`tel:${rawAdvisor.phone}`}
              class="inline-block px-8 py-3 bg-white text-[#f04e00] rounded-lg hover:bg-gray-100 transition-colors font-medium"
            >
              {text.ctaButton1}
            </a>
          )}
          
          <a 
            href={`${currentRoutes.properties}?advisor=${rawAdvisor.slug}`}
            class="inline-block px-8 py-3 bg-white/20 text-white border border-white rounded-lg hover:bg-white/30 transition-colors font-medium"
          >
            {text.ctaButton2}
          </a>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  /* Estilos para texto justificado en la bio */
  [set\:html] {
    text-align: justify;
    line-height: 1.6;
  }
  
  /* Estilos para enlaces dentro de la bio */
  [set\:html] a {
    @apply text-[#f04e00] hover:underline;
  }
  
  /* Estilos para párrafos dentro de la bio */
  [set\:html] p {
    @apply mb-4;
  }
  
  /* Estilos para encabezados dentro de la bio */
  [set\:html] h1, [set\:html] h2, [set\:html] h3, [set\:html] h4, [set\:html] h5, [set\:html] h6 {
    @apply font-bold mb-2 mt-4;
  }
  
  /* Estilos para listas dentro de la bio */
  [set\:html] ul, [set\:html] ol {
    @apply pl-6 mb-4;
  }
  
  [set\:html] li {
    @apply mb-1;
  }
  
  /* Estilos para negritas e italicas */
  [set\:html] strong, [set\:html] b {
    @apply font-bold;
  }
  
  [set\:html] em, [set\:html] i {
    @apply italic;
  }
</style>