---
export interface Props {
  propertyData: any;
}

const { propertyData } = Astro.props;

// Extraer datos de la propiedad individual
const property = propertyData.property;
const agent = propertyData.agent;
const seo = propertyData.seo;
---

<div class="property-detail-single">
  <!-- Breadcrumb -->
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <div class="container">
      <div class="breadcrumb-item">
        <a href="/">Inicio</a>
      </div>
      <div class="breadcrumb-item">
        <a href="/comprar">Venta</a>
      </div>
      <div class="breadcrumb-item">
        <a href={`/comprar/${property.cities?.name?.toLowerCase().replace(/\s+/g, '-')}`}>
          {property.cities?.name}
        </a>
      </div>
      <div class="breadcrumb-item">
        <span>{property.sectors?.name}</span>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="property-layout">
      <!-- Columna principal -->
      <main class="property-main">
        <!-- Galería de imágenes -->
        <div class="image-gallery">
          <div class="main-image">
            <img src={property.main_image_url} alt={property.name} />
          </div>
          {property.property_images && property.property_images.length > 1 && (
            <div class="thumbnail-gallery">
              {property.property_images.slice(1, 5).map((image) => (
                <div class="thumbnail" key={image.url}>
                  <img src={image.url} alt={image.title || property.name} />
                </div>
              ))}
            </div>
          )}
        </div>

        <!-- Información básica -->
        <div class="property-header">
          <div class="property-info">
            <h1 class="property-title">{property.name}</h1>
            <div class="property-location">
              <i class="fas fa-map-marker-alt"></i>
              {property.sectors?.name}, {property.cities?.name}
            </div>
            <div class="property-price">
              {property.pricing_unified?.display_price?.formatted}
            </div>
          </div>
        </div>

        <!-- Características principales -->
        <div class="property-features">
          <h2>Características</h2>
          <div class="features-grid">
            <div class="feature-item">
              <i class="fas fa-bed"></i>
              <span>{property.bedrooms} Habitaciones</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-bath"></i>
              <span>{property.bathrooms} Baños</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-car"></i>
              <span>{property.parking_spots} Parqueos</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-vector-square"></i>
              <span>{property.built_area}m²</span>
            </div>
          </div>
        </div>

        <!-- Descripción -->
        {property.description && (
          <div class="property-description">
            <h2>Descripción</h2>
            <p>{property.description}</p>
          </div>
        )}

        <!-- Amenidades -->
        {property.property_amenities && property.property_amenities.length > 0 && (
          <div class="property-amenities">
            <h2>Amenidades</h2>
            <div class="amenities-list">
              {property.property_amenities.map((amenity) => (
                <div class="amenity-item" key={amenity.amenity_id}>
                  <i class="fas fa-check"></i>
                  <span>{amenity.amenities.name}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </main>

      <!-- Sidebar -->
      <aside class="property-sidebar">
        {agent && (
          <div class="agent-card">
            <h3>Contactar Agente</h3>
            <div class="agent-info">
              <h4>{agent.name}</h4>
              <p>{agent.position}</p>
              <div class="agent-contact">
                <a href={`tel:${agent.phone}`} class="btn-phone">
                  <i class="fas fa-phone"></i>
                  Llamar
                </a>
                <a href={`https://wa.me/${agent.phone?.replace(/[^0-9]/g, '')}`} class="btn-whatsapp">
                  <i class="fab fa-whatsapp"></i>
                  WhatsApp
                </a>
              </div>
            </div>
          </div>
        )}

        <div class="property-summary">
          <h3>Resumen</h3>
          <div class="summary-item">
            <span>Precio:</span>
            <strong>{property.pricing_unified?.display_price?.formatted}</strong>
          </div>
          <div class="summary-item">
            <span>Área:</span>
            <strong>{property.built_area}m²</strong>
          </div>
          <div class="summary-item">
            <span>Tipo:</span>
            <strong>{property.property_categories?.name}</strong>
          </div>
          <div class="summary-item">
            <span>Referencia:</span>
            <strong>{property.code}</strong>
          </div>
        </div>
      </aside>
    </div>
  </div>
</div>

<style>
  .breadcrumb {
    background-color: #f5f5f5;
    padding: 1rem 0;
  }

  .breadcrumb-item {
    display: inline-flex;
    align-items: center;
    font-size: 0.9rem;
    color: #666;
    font-weight: 500;
  }

  .breadcrumb-item:not(:last-child)::after {
    content: '/';
    margin: 0 10px;
    color: #ccc;
  }

  .breadcrumb-item a:hover {
    color: #FF4D10;
  }

  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .property-layout {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin: 2rem 0;
  }

  .image-gallery {
    margin-bottom: 2rem;
  }

  .main-image {
    width: 100%;
    height: 400px;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .main-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .thumbnail-gallery {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
  }

  .thumbnail {
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .thumbnail:hover img {
    transform: scale(1.1);
  }

  .property-title {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: #333;
  }

  .property-location {
    display: flex;
    align-items: center;
    color: #666;
    margin-bottom: 1rem;
  }

  .property-location i {
    margin-right: 0.5rem;
    color: #FF4D10;
  }

  .property-price {
    font-size: 2rem;
    font-weight: 700;
    color: #FF4D10;
    margin-bottom: 2rem;
  }

  .features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin: 1rem 0;
  }

  .feature-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
  }

  .feature-item i {
    color: #FF4D10;
    font-size: 1.2rem;
  }

  .property-description {
    margin: 2rem 0;
  }

  .property-amenities {
    margin: 2rem 0;
  }

  .amenities-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
  }

  .amenity-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
  }

  .amenity-item i {
    color: #28a745;
  }

  .agent-card, .property-summary {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-bottom: 1.5rem;
  }

  .agent-contact {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .btn-phone, .btn-whatsapp {
    flex: 1;
    padding: 0.75rem;
    border-radius: 8px;
    text-decoration: none;
    text-align: center;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-phone {
    background: #FF4D10;
    color: white;
  }

  .btn-whatsapp {
    background: #25d366;
    color: white;
  }

  .btn-phone:hover, .btn-whatsapp:hover {
    transform: translateY(-2px);
  }

  .summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
  }

  .summary-item:last-child {
    border-bottom: none;
  }

  h2, h3 {
    color: #333;
    margin-bottom: 1rem;
  }

  @media (max-width: 768px) {
    .property-layout {
      grid-template-columns: 1fr;
    }
    
    .features-grid,
    .amenities-list {
      grid-template-columns: 1fr;
    }
    
    .property-title {
      font-size: 1.5rem;
    }
    
    .property-price {
      font-size: 1.5rem;
    }
  }
</style>